<!-- this is a global static patch html file  -->



<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->

<!-- Mirrored from zero.digipen.edu/Workshops/2016/VectorMath2.html by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 27 Dec 2022 23:50:41 GMT -->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Vector Math, part 2 &mdash; Zero Engine 1.0 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="Zero Engine 1.0 documentation" href="../../index-2.html"/>
        <link rel="up" title="Video Game Development Level 1 - 2016" href="index.html"/>
        <link rel="next" title="2D Rotation" href="2DRotation.html"/>
        <link rel="prev" title="Object Creation" href="ObjectCreation.html"/>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','../../../www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-30697525-2', 'auto');
  ga('send', 'pageview');

</script>



  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index-2.html" class="icon icon-home"> Zero Engine
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="https://zero.digipen.edu/search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference external" href="../../Launcher/ZeroLauncherSetup.html">Download Zero</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../GettingStarted/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ZeroManual/index.html">Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Tutorials/index.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Community/index.html">Community</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Classes &amp; Workshops</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../GAM100/index.html">GAM100</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Proj101/index.html">Project 101</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Video Game Development Level 1 - 2016</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="Launcher.html">The Zero Launcher</a></li>
<li class="toctree-l3"><a class="reference internal" href="EditorUI.html">Editor UI</a></li>
<li class="toctree-l3"><a class="reference internal" href="GameObjects.html">Game Objects</a></li>
<li class="toctree-l3"><a class="reference internal" href="AddingComponents.html">Adding Components</a></li>
<li class="toctree-l3"><a class="reference internal" href="VectorMath1.html">Vector Math, part 1</a></li>
<li class="toctree-l3"><a class="reference internal" href="Hierarchies.html">Hierarchies</a></li>
<li class="toctree-l3"><a class="reference internal" href="Resources.html">Resources</a></li>
<li class="toctree-l3"><a class="reference internal" href="PhysicsEffects.html">Regions &amp; Physics Effects</a></li>
<li class="toctree-l3"><a class="reference internal" href="Sprites.html">Sprites</a></li>
<li class="toctree-l3"><a class="reference internal" href="Area.html">Area Component</a></li>
<li class="toctree-l3"><a class="reference internal" href="Text.html">Sprite Text</a></li>
<li class="toctree-l3"><a class="reference internal" href="Scripting1.html">Scripting 1</a></li>
<li class="toctree-l3"><a class="reference internal" href="Scripting2.html">Scripting 2</a></li>
<li class="toctree-l3"><a class="reference internal" href="Scripting3.html">Scripting 3</a></li>
<li class="toctree-l3"><a class="reference internal" href="Scripting4.html">Scripting 4</a></li>
<li class="toctree-l3"><a class="reference internal" href="HierarchiesInCode.html">Hierarchies in Code</a></li>
<li class="toctree-l3"><a class="reference internal" href="Events1.html">Events</a></li>
<li class="toctree-l3"><a class="reference internal" href="Events2.html">Events 2</a></li>
<li class="toctree-l3"><a class="reference internal" href="Events3.html">Events 3</a></li>
<li class="toctree-l3"><a class="reference internal" href="Events4.html">Events 4</a></li>
<li class="toctree-l3"><a class="reference internal" href="CogPaths.html">Cog Paths</a></li>
<li class="toctree-l3"><a class="reference internal" href="Archetypes.html">Archetypes</a></li>
<li class="toctree-l3"><a class="reference internal" href="Spaces.html">Spaces</a></li>
<li class="toctree-l3"><a class="reference internal" href="ObjectCreation.html">Object Creation</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Vector Math, part 2</a><ul class="simple">
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="2DRotation.html">2D Rotation</a></li>
<li class="toctree-l3"><a class="reference internal" href="Levels.html">Levels</a></li>
<li class="toctree-l3"><a class="reference internal" href="ParticleEffects.html">Particle Effects</a></li>
<li class="toctree-l3"><a class="reference internal" href="UsingTheSweptController.html">Using the Swept Controller</a></li>
<li class="toctree-l3"><a class="reference internal" href="FollowingCamera.html">Following Camera</a></li>
<li class="toctree-l3"><a class="reference internal" href="AnimatedSpritesSheets.html">Animated Player</a></li>
<li class="toctree-l3"><a class="reference internal" href="TileEditorAndSpriteSheets.html">Tile Editor and Sprite Sheets</a></li>
<li class="toctree-l3"><a class="reference internal" href="SameLevelCheckpoints.html">Level Checkpoints</a></li>
<li class="toctree-l3"><a class="reference internal" href="ParallaxBackground.html">Parallax Background</a></li>
<li class="toctree-l3"><a class="reference internal" href="HeadsUpDisplay.html">Heads Up Display</a></li>
<li class="toctree-l3"><a class="reference internal" href="UserInterface.html">User Interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="Actions.html">Actions</a></li>
<li class="toctree-l3"><a class="reference internal" href="Audio.html">Audio</a></li>
<li class="toctree-l3"><a class="reference internal" href="ObjectStore.html">Saving and Loading Data</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="TeachersGuide.html">Teacher&#8217;s Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../2015/index.html">Video Game Development Level 1 - 2015</a></li>
<li class="toctree-l2"><a class="reference internal" href="../2015/TeachersGuide.html">Teacher&#8217;s Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../2014/index.html">Introduction to 2D Video Game Programming</a></li>
<li class="toctree-l2"><a class="reference internal" href="../2014/TeachersGuide.html">Teacher&#8217;s Guide</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../Support/index.html">Zero Engine Support</a></li>
<li class="toctree-l1"><a class="reference external" href="https://survey.digipen.edu/survey/index/sid/524363/newtest/Y/lang/en">Feedback Survey</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index-2.html">Zero Engine</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index-2.html">Docs</a> &raquo;</li>
      
          <li><a href="../index.html">Classes &amp; Workshops</a> &raquo;</li>
      
          <li><a href="index.html">Video Game Development Level 1 - 2016</a> &raquo;</li>
      
    <li>Vector Math, part 2</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../_sources/Workshops/2016/VectorMath2.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <!-- this is used as a file for inclusion in other .rst files --><div class="searchtitle section" id="vector-math-part-2">
<span id="vectormath2"></span><h1>Vector Math, part 2</h1>
<p class="searchdescription">This lesson revisits the topic of vector math, covering more of what can be done
with vectors and how the Zero engine uses them in a game.</p>
<div class="section" id="learning-objectives">
<span id="vectormath2vocab"></span><h2>Learning Objectives</h2>
<ul class="simple">
<li>To learn how to find a vector&#8217;s angle of rotation using the <code class="docutils literal"><span class="pre">ATan2</span></code>
function</li>
<li>To learn how to find a vector from a given angle using the <code class="docutils literal"><span class="pre">Cos</span></code> and
<code class="docutils literal"><span class="pre">Sin</span></code> functions</li>
<li>To become familiar with the <strong>dot product</strong> of two vectors</li>
</ul>
<table border="1" class="vocabsection docutils">
<colgroup>
<col width="25%" />
<col width="25%" />
<col width="25%" />
<col width="25%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head" colspan="4">Vocabulary</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>vector</td>
<td>dot product</td>
<td>radians</td>
<td>Euler angles</td>
</tr>
<tr class="row-odd"><td>Math.ATan2</td>
<td>Math.Cos</td>
<td>Math.Sin</td>
<td>right triangle</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="create-a-new-project">
<h2>Create a New Project</h2>
<p><a class="reference internal" href="LauncherNewProject.html#createnewproject"><span>Create a New 2D Project</span></a></p>
<ul class="simple">
<li>In the Objects Window<ul>
<li><a class="reference internal" href="SelectObject.html#selectobject"><span>Select the LevelSettings object</span></a></li>
</ul>
</li>
<li>In the Properties Window<ul>
<li><a class="reference internal" href="AddComponent.html#removecomponent"><span>Remove the GravityEffect Component</span></a></li>
</ul>
</li>
</ul>
<p>In order to help us understand some of the principles of vector math, let&#8217;s make
a demo that uses a common vector-related task: <strong>firing toward the mouse</strong>.
Let&#8217;s make a player with a cool water cannon.</p>
<ul>
<li><p class="first"><a class="reference internal" href="Commands.html#commands"><span>Command</span></a> : <code class="docutils literal"><span class="pre">CreateSprite</span></code> or <span class="menuselection">Create ‣ Create Sprite</span></p>
</li>
<li><p class="first">In the Properties Window</p>
<ul class="simple">
<li>Set Name to: <code class="docutils literal"><span class="pre">Player</span></code></li>
<li>Under <a class="reference internal" href="../../ZeroManual/CodeReference/Reference/Sprite.html#_CPPv26Sprite" title="Sprite"><code class="xref cpp cpp-type docutils literal"><span class="pre">Sprite</span></code></a><ul>
<li>Set Color to: <code class="docutils literal"><span class="pre">[R:</span> <span class="pre">0,</span> <span class="pre">G:</span> <span class="pre">128,</span> <span class="pre">B:</span> <span class="pre">64,</span> <span class="pre">A:</span> <span class="pre">1.0]</span></code>, <code class="docutils literal"><span class="pre">#008040</span></code></li>
<li>Set <a class="reference internal" href="../../ZeroManual/CodeReference/Reference/SpriteSource.html#_CPPv212SpriteSource" title="SpriteSource"><code class="xref cpp cpp-type docutils literal"><span class="pre">SpriteSource</span></code></a> to: <code class="docutils literal"><span class="pre">SquareBordered</span></code></li>
</ul>
</li>
</ul>
</li>
<li><p class="first"><a class="reference internal" href="Commands.html#commands"><span>Command</span></a> : <code class="docutils literal"><span class="pre">CreateSprite</span></code> or <span class="menuselection">Create ‣ Create Sprite</span></p>
</li>
<li><p class="first">In the Properties Window</p>
<ul class="simple">
<li>Set Name to: <code class="docutils literal"><span class="pre">WaterCannon</span></code></li>
<li>Under <a class="reference internal" href="../../ZeroManual/CodeReference/Reference/Transform.html#_CPPv29Transform" title="Transform"><code class="xref cpp cpp-type docutils literal"><span class="pre">Transform</span></code></a><ul>
<li>Set Translation to: <code class="docutils literal"><span class="pre">[0.5,</span> <span class="pre">0,</span> <span class="pre">1]</span></code></li>
<li>Set Scale to: <code class="docutils literal"><span class="pre">[0.5,</span> <span class="pre">0.5,</span> <span class="pre">0.5]</span></code></li>
</ul>
</li>
<li>Under <a class="reference internal" href="../../ZeroManual/CodeReference/Reference/Sprite.html#_CPPv26Sprite" title="Sprite"><code class="xref cpp cpp-type docutils literal"><span class="pre">Sprite</span></code></a><ul>
<li>Set Color to: <code class="docutils literal"><span class="pre">[R:</span> <span class="pre">0,</span> <span class="pre">G:</span> <span class="pre">0,</span> <span class="pre">B:</span> <span class="pre">255,</span> <span class="pre">A:</span> <span class="pre">1.0]</span></code>, <code class="docutils literal"><span class="pre">#0000FF</span></code></li>
<li>Set <a class="reference internal" href="../../ZeroManual/CodeReference/Reference/SpriteSource.html#_CPPv212SpriteSource" title="SpriteSource"><code class="xref cpp cpp-type docutils literal"><span class="pre">SpriteSource</span></code></a> to: <code class="docutils literal"><span class="pre">SquareBordered</span></code></li>
</ul>
</li>
</ul>
</li>
<li><p class="first">In the Objects Window</p>
<ul>
<li><p class="first"><code class="docutils literal"><span class="pre">Left-Drag</span></code> the WaterCannon object onto the Player object to
<a class="reference internal" href="Hierarchies.html#hierarchies"><span>parent</span></a> the WaterCannon to the Player</p>
<p><img alt="Player" src="../../_images/Player3.png" /></p>
</li>
</ul>
</li>
</ul>
<p>Now we&#8217;ve built our player, complete with a blue water cannon that serves nicely
to show our player&#8217;s facing direction. (We moved the cannon a little bit in the
positive Z direction as a quick way to avoid Z-fighting; normally, it is proper
to use a custom <a class="reference internal" href="../../ZeroManual/CodeReference/Reference/SpriteLayerOrder.html#_CPPv216SpriteLayerOrder" title="SpriteLayerOrder"><code class="xref cpp cpp-type docutils literal"><span class="pre">SpriteLayerOrder</span></code></a> to accomplish this.)</p>
</div>
<div class="section" id="looking-at-the-mouse">
<h2>Looking at the Mouse</h2>
<p>Now let&#8217;s give the player a new Zilch <a class="reference internal" href="../../ZeroManual/CodeReference/Reference/Component.html#_CPPv29Component" title="Component"><code class="xref cpp cpp-type docutils literal"><span class="pre">component</span></code></a> that will
allow it to &#8220;look at&#8221; the mouse.</p>
<ul class="simple">
<li><a class="reference internal" href="ResourceAdding.html#resourceadding"><span>Add a new ZilchScript resource</span></a> named: <code class="docutils literal"><span class="pre">MouseLook</span></code></li>
<li>Update your new script to look like this:</li>
</ul>
<div class="highlight-csharp"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MouseLook</span> <span class="p">:</span> <span class="n">ZilchComponent</span>
<span class="p">{</span>
  <span class="n">function</span> <span class="nf">Initialize</span><span class="p">(</span><span class="n">init</span> <span class="p">:</span> <span class="n">CogInitializer</span><span class="p">)</span>
  <span class="p">{</span>

  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li>In the MouseLook script<ul>
<li>Make the following set of additions to the code:</li>
</ul>
</li>
</ul>
<div class="highlight-csharp"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MouseLook</span> <span class="p">:</span> <span class="n">ZilchComponent</span>
<span class="p">{</span>
<span class="hll"><span class="na">  [Dependency]</span>
</span><span class="hll">  <span class="kt">var</span> <span class="n">Transform</span> <span class="p">:</span> <span class="n">Transform</span><span class="p">;</span>
</span>
  <span class="p">.</span>
  <span class="p">.</span>
  <span class="p">.</span>
</pre></div>
</div>
<p>Marking this component with a <strong>dependency</strong> on <a class="reference internal" href="../../ZeroManual/CodeReference/Reference/Transform.html#_CPPv29Transform" title="Transform"><code class="xref cpp cpp-type docutils literal"><span class="pre">Transform</span></code></a> makes it
so that it cannot be added to any cog that does not already have a Transform
component. It also allows us to refer to the Transform by typing
<code class="docutils literal"><span class="pre">this.Transform</span></code> instead of <code class="docutils literal"><span class="pre">this.Owner.Transform</span></code>.</p>
<div class="nextblock container">
Next:</div>
<div class="highlight-csharp"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MouseLook</span> <span class="p">:</span> <span class="n">ZilchComponent</span>
<span class="p">{</span>
<span class="na">  [Dependency]</span>
  <span class="kt">var</span> <span class="n">Transform</span> <span class="p">:</span> <span class="n">Transform</span><span class="p">;</span>


  <span class="n">function</span> <span class="nf">Initialize</span><span class="p">(</span><span class="n">init</span> <span class="p">:</span> <span class="n">CogInitializer</span><span class="p">)</span>
  <span class="p">{</span>
<span class="hll">    <span class="n">Zero</span><span class="p">.</span><span class="n">Connect</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">LevelSettings</span><span class="p">,</span> <span class="n">Events</span><span class="p">.</span><span class="n">MouseUpdate</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="n">OnMouseUpdate</span><span class="p">);</span>
</span>  <span class="p">}</span>


<span class="hll">  <span class="n">function</span> <span class="nf">OnMouseUpdate</span><span class="p">(</span><span class="k">event</span> <span class="p">:</span> <span class="n">ViewportMouseEvent</span><span class="p">)</span>
</span><span class="hll">  <span class="p">{</span>
</span><span class="hll">
</span><span class="hll">  <span class="p">}</span>
</span><span class="p">}</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">MouseUpdate</span></code> <a class="reference internal" href="../../ZeroManual/CodeReference/Reference/Event.html#_CPPv25Event" title="Event"><code class="xref cpp cpp-type docutils literal"><span class="pre">event</span></code></a> is dispatched every frame, and the
<a class="reference internal" href="../../ZeroManual/CodeReference/Reference/ViewportMouseEvent.html#_CPPv218ViewportMouseEvent" title="ViewportMouseEvent"><code class="xref cpp cpp-type docutils literal"><span class="pre">ViewportMouseEvent</span></code></a> it uses contains some useful members, including
a function that can tell us the location of the mouse in world space.</p>
<ul class="simple">
<li><a class="reference internal" href="SelectObject.html#selectobject"><span>Select the Player object</span></a></li>
<li>In the Properties Window<ul>
<li><a class="reference internal" href="AddComponent.html#addcomponent"><span>Add a MouseLook component</span></a></li>
</ul>
</li>
<li><a class="reference internal" href="SavingProject.html#savingproject"><span>Save the project</span></a></li>
</ul>
<div class="section" id="difference-vector">
<h3>Difference Vector</h3>
<p>To make the player face the mouse, we&#8217;ll need to figure out what angle to rotate
the player to so that its <strong>facing vector</strong> is aligned with the vector going
from the player to the mouse. Recall from the
<a class="reference internal" href="VectorMath1.html#vectormath1"><span>previous lesson on vector math</span></a> that the vector going
from one point to another is the <strong>difference</strong> between the two points:</p>
<p><img alt="P1MinusP0" src="../../_images/P1MinusP01.png" /></p>
<p>So, it looks like we&#8217;re going to be subtracting some vectors.</p>
<ul class="simple">
<li>In the MouseLook script<ul>
<li>Make the following set of additions to the <code class="docutils literal"><span class="pre">OnMouseUpdate</span></code> function:</li>
</ul>
</li>
</ul>
<div class="highlight-csharp"><div class="highlight"><pre><span></span><span class="n">function</span> <span class="nf">OnMouseUpdate</span><span class="p">(</span><span class="k">event</span> <span class="p">:</span> <span class="n">ViewportMouseEvent</span><span class="p">)</span>
<span class="p">{</span>
<span class="hll">  <span class="kt">var</span> <span class="n">mousePosition</span> <span class="p">=</span> <span class="k">event</span><span class="p">.</span><span class="n">ToWorldZPlane</span><span class="p">(</span><span class="m">0.0</span><span class="p">);</span>
</span><span class="p">}</span>
</pre></div>
</div>
<p>First of all, we need to know where the mouse is pointing. To find its position,
we can use the <code class="docutils literal"><span class="pre">ToWorldZPlane</span></code> function on the ViewportMouseEvent. This takes
in a <code class="xref cpp cpp-type docutils literal"><span class="pre">Real</span></code> representing the desired <em>depth</em>, and returns a
<code class="xref cpp cpp-type docutils literal"><span class="pre">Real3</span></code> representing the mouse&#8217;s <em>position at that depth</em>. For a 2D
project like this one, we&#8217;ll almost always give this function a depth of
<code class="docutils literal"><span class="pre">0.0</span></code>. Doing so here gives us the <code class="docutils literal"><span class="pre">mousePosition</span></code>.</p>
<div class="nextblock container">
Next:</div>
<div class="highlight-csharp"><div class="highlight"><pre><span></span><span class="n">function</span> <span class="nf">OnMouseUpdate</span><span class="p">(</span><span class="k">event</span> <span class="p">:</span> <span class="n">ViewportMouseEvent</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">var</span> <span class="n">mousePosition</span> <span class="p">=</span> <span class="k">event</span><span class="p">.</span><span class="n">ToWorldZPlane</span><span class="p">(</span><span class="m">0.0</span><span class="p">);</span>
<span class="hll">  <span class="kt">var</span> <span class="n">playerPosition</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">Transform</span><span class="p">.</span><span class="n">WorldTranslation</span><span class="p">;</span>
</span><span class="p">}</span>
</pre></div>
</div>
<p>Here, we get the <code class="docutils literal"><span class="pre">playerPosition</span></code> from the player&#8217;s <a class="reference internal" href="../../ZeroManual/CodeReference/Reference/Transform.html#_CPPv29Transform" title="Transform"><code class="xref cpp cpp-type docutils literal"><span class="pre">Transform</span></code></a>.
Note that we can refer to the player&#8217;s <a class="reference internal" href="../../ZeroManual/CodeReference/Reference/Transform.html#_CPPv29Transform" title="Transform"><code class="xref cpp cpp-type docutils literal"><span class="pre">Transform</span></code></a> by typing just
<code class="docutils literal"><span class="pre">this.Transform</span></code> instead of <code class="docutils literal"><span class="pre">this.Owner.Transform</span></code> &#8212; this is because we
have defined this component to have a <a class="reference internal" href="../../ZeroManual/CodeReference/Reference/Transform.html#_CPPv29Transform" title="Transform"><code class="xref cpp cpp-type docutils literal"><span class="pre">Transform</span></code></a> <strong>dependency</strong>.</p>
<div class="nextblock container">
Next:</div>
<div class="highlight-csharp"><div class="highlight"><pre><span></span><span class="n">function</span> <span class="nf">OnMouseUpdate</span><span class="p">(</span><span class="k">event</span> <span class="p">:</span> <span class="n">ViewportMouseEvent</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">var</span> <span class="n">mousePosition</span> <span class="p">=</span> <span class="k">event</span><span class="p">.</span><span class="n">ToWorldZPlane</span><span class="p">(</span><span class="m">0.0</span><span class="p">);</span>
  <span class="kt">var</span> <span class="n">playerPosition</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">Transform</span><span class="p">.</span><span class="n">WorldTranslation</span><span class="p">;</span>

<span class="hll">  <span class="kt">var</span> <span class="n">vectorToMouse</span> <span class="p">=</span> <span class="n">mousePosition</span> <span class="p">-</span> <span class="n">playerPosition</span><span class="p">;</span>
</span><span class="p">}</span>
</pre></div>
</div>
<p>Next is the vector subtraction that was mentioned earlier: the vector that
goes from the player to the mouse is equal to the <code class="docutils literal"><span class="pre">mousePosition</span></code> minus
the <code class="docutils literal"><span class="pre">playerPosition</span></code>.</p>
<p><img alt="DifferenceVectorDiagram" src="../../_images/DifferenceVectorDiagram1.png" /></p>
</div>
<div class="section" id="mouse-angle">
<h3>Mouse Angle</h3>
<p>Now that we have the <strong>difference vector</strong>, we can use it to find the <strong>mouse
angle</strong> by using a very useful trigonometric function: <code class="docutils literal"><span class="pre">Math.ATan2</span></code>. But
before we proceed, there are a couple of things we need to cover.</p>
<div class="section" id="radians">
<h4>Radians</h4>
<p>How do you find the circumference of a circle? <strong>2 times</strong> <span class="math">\(\pi\)</span> <strong>times
the radius of the circle</strong>. So if the radius is 1 (as it would be in the <strong>unit
circle</strong>), then the circle&#8217;s circumference is just <span class="math">\(2\pi\)</span>.</p>
<div class="sidebar">
<p class="first sidebar-title"><span class="math">\(\pi\)</span></p>
<p class="last">Remember, <span class="math">\(\pi=3.14159\ldots\)</span>, but in Zero, <code class="docutils literal"><span class="pre">Math.Pi</span></code>
works just fine.</p>
</div>
<p>This is the foundation for another way to measure angles. The angle of a full
circle is 360 degrees, or <span class="math">\(2\pi\)</span> <strong>radians</strong>; likewise, a half circle is
half that: 180 degrees, or half of <span class="math">\(2\pi\)</span>, so, just <span class="math">\(\pi\)</span>
<strong>radians</strong>. A right angle &#8212; that is, one quarter of a circle &#8212; measures 90
degrees, or one quarter of <span class="math">\(2\pi\)</span>: <span class="math">\(\frac{\pi}{2}\)</span>. Any angle can be
measured this way, and <strong>radians are what the Zero Engine uses to measure
angles</strong>.</p>
<ul class="simple">
<li>Any function that the Zero Engine uses that takes an angle will expect it in
radians &#8212; giving it an angle in degrees won&#8217;t cause an error or anything,
but it will produce the wrong results.</li>
<li>Converting an angle from degrees to radians is as simple as multiplying by
<span class="math">\(\frac{\pi}{180}\)</span>; likewise, multiplying by <span class="math">\(\frac{180}{\pi}\)</span>
will convert from radians to degrees.<ul>
<li>For convenience, Zero has two functions that do exactly this:
<code class="docutils literal"><span class="pre">Math.ToRadians</span></code> and <code class="docutils literal"><span class="pre">Math.ToDegrees</span></code>.</li>
</ul>
</li>
</ul>
<p><img alt="DegreesAndRadians" src="../../_images/DegreesAndRadians1.png" /></p>
</div>
<div class="section" id="euler-angles">
<h4>Euler Angles</h4>
<p>Rotating objects in 3D space can be surprisingly complicated. In 2D, when we
want to rotate something, we generally use only <strong>one axis of rotation</strong>,
whereas in 3D, there are <em>three separate rotation axes</em>. To make matters worse,
changing the order that these three axes are rotated in can change the resulting
orientation of the object. To solve this problem, 3D game engines like Zero use
an advanced mathematical concept called <em>quaternions</em>, or
&#8220;<a class="reference internal" href="../../ZeroManual/CodeReference/Reference/Quat.html#_CPPv24Quat" title="Quat"><code class="xref cpp cpp-type docutils literal"><span class="pre">quats</span></code></a>&#8221; for short. Quats are pretty tough to wrap your head
around, so we can use a simpler alternate way of rotating objects.</p>
<p>Just as an object can move in three axes &#8212; <strong>X</strong> (side to side), <strong>Y</strong> (up and
down), and <strong>Z</strong> (towards and away from the camera) &#8212; it can also <strong>rotate
around</strong> each of these axes:</p>
<p><img alt="RotationAxes" src="../../_images/RotationAxes1.gif" /></p>
<p>The object can be rotated by a different angle around each axis. The combination
of these three angles into one three-dimensional number is what we call the
object&#8217;s <strong>Euler angles</strong>, named after the Swiss mathematician Leonhard Euler
(1707-1783). Euler angles are a handy alternative to quaternions. (We&#8217;ll look at
quats again a bit more in the next lesson.)</p>
<p>Note that, in a 2D game, we&#8217;ll usually be concerned only with an object&#8217;s <strong>Z
rotation</strong> &#8212; that is, its angle of rotation around its Z axis, or the Z part
of its Euler angles. This Z rotation is exactly what we&#8217;ll manipulate when we
rotate the player to look at the mouse.</p>
<ul class="simple">
<li>In the MouseLook script<ul>
<li>Make the following set of additions to the <code class="docutils literal"><span class="pre">OnMouseUpdate</span></code> function:</li>
</ul>
</li>
</ul>
<div class="highlight-csharp"><div class="highlight"><pre><span></span><span class="n">function</span> <span class="nf">OnMouseUpdate</span><span class="p">(</span><span class="k">event</span> <span class="p">:</span> <span class="n">ViewportMouseEvent</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">var</span> <span class="n">mousePosition</span> <span class="p">=</span> <span class="k">event</span><span class="p">.</span><span class="n">ToWorldZPlane</span><span class="p">(</span><span class="m">0.0</span><span class="p">);</span>
  <span class="kt">var</span> <span class="n">playerPosition</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">Transform</span><span class="p">.</span><span class="n">WorldTranslation</span><span class="p">;</span>

  <span class="kt">var</span> <span class="n">vectorToMouse</span> <span class="p">=</span> <span class="n">mousePosition</span> <span class="p">-</span> <span class="n">playerPosition</span><span class="p">;</span>

<span class="hll">  <span class="c1">// The ATan2 function returns an angle in radians</span>
</span><span class="hll">  <span class="kt">var</span> <span class="n">mouseAngle</span> <span class="p">=</span> <span class="n">Math</span><span class="p">.</span><span class="n">ATan2</span><span class="p">(</span><span class="n">vectorToMouse</span><span class="p">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">vectorToMouse</span><span class="p">.</span><span class="n">X</span><span class="p">);</span>
</span><span class="p">}</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">ATan2</span></code> function gives us the angle of rotation of our vector. To use it,
we must pass in the <em>Y-part</em> and the <em>X-part</em> of the vector, <strong>in that order</strong>.</p>
<ul class="simple">
<li>The <code class="docutils literal"><span class="pre">ATan2</span></code> function returns an angle in <strong>radians</strong>.</li>
</ul>
<p><img alt="MouseAngleDiagram" src="../../_images/MouseAngleDiagram1.png" /></p>
<p>Once we have the proper rotation angle, we can rotate the player.</p>
<div class="nextblock container">
Finally:</div>
<div class="highlight-csharp"><div class="highlight"><pre><span></span><span class="n">function</span> <span class="nf">OnMouseUpdate</span><span class="p">(</span><span class="k">event</span> <span class="p">:</span> <span class="n">ViewportMouseEvent</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">var</span> <span class="n">mousePosition</span> <span class="p">=</span> <span class="k">event</span><span class="p">.</span><span class="n">ToWorldZPlane</span><span class="p">(</span><span class="m">0.0</span><span class="p">);</span>
  <span class="kt">var</span> <span class="n">playerPosition</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">Transform</span><span class="p">.</span><span class="n">WorldTranslation</span><span class="p">;</span>

  <span class="kt">var</span> <span class="n">vectorToMouse</span> <span class="p">=</span> <span class="n">mousePosition</span> <span class="p">-</span> <span class="n">playerPosition</span><span class="p">;</span>

  <span class="c1">// The ATan2 function returns an angle in radians</span>
  <span class="kt">var</span> <span class="n">mouseAngle</span> <span class="p">=</span> <span class="n">Math</span><span class="p">.</span><span class="n">ATan2</span><span class="p">(</span><span class="n">vectorToMouse</span><span class="p">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">vectorToMouse</span><span class="p">.</span><span class="n">X</span><span class="p">);</span>
<span class="hll">  <span class="c1">// The SetEulerAnglesXYZ function expects angles in radians</span>
</span><span class="hll">  <span class="k">this</span><span class="p">.</span><span class="n">Transform</span><span class="p">.</span><span class="n">SetEulerAnglesXYZ</span><span class="p">(</span><span class="m">0.0</span><span class="p">,</span> <span class="m">0.0</span><span class="p">,</span> <span class="n">mouseAngle</span><span class="p">);</span>
</span><span class="p">}</span>
</pre></div>
</div>
<p>Remember, when rotating an object in a 2D game, we&#8217;ll usually only want it to
rotate around the Z axis. We can do this by calling the <code class="docutils literal"><span class="pre">SetEulerAnglesXYZ</span></code>
function and passing in zeroes for X and Y.</p>
<ul class="simple">
<li>The <code class="docutils literal"><span class="pre">SetEulerAnglesXYZ</span></code> function expects angles in <strong>radians</strong>.</li>
</ul>
<p>Now we&#8217;re ready to try it out.</p>
<ul class="simple">
<li><a class="reference internal" href="SavingProject.html#savingproject"><span>Save the project</span></a> and <a class="reference internal" href="RunTheGame.html#runthegame"><span>run the game</span></a></li>
<li>Move the mouse around and observe what happens.</li>
</ul>
<p><img alt="MouseRotation" src="../../_images/MouseRotation1.gif" /></p>
<p>The player now faces the mouse pointer. Now it&#8217;s time to make the water cannon
shoot water!</p>
</div>
</div>
</div>
<div class="section" id="firing-toward-the-mouse">
<h2>Firing Toward the Mouse</h2>
<p>First, we need to create the <a class="reference internal" href="../../ZeroManual/CodeReference/Reference/Archetype.html#_CPPv29Archetype" title="Archetype"><code class="xref cpp cpp-type docutils literal"><span class="pre">archetype</span></code></a> that the water
cannon is going to use for water.</p>
<ul>
<li><p class="first"><a class="reference internal" href="StopGame.html#stopgame"><span>Stop the Game</span></a></p>
</li>
<li><p class="first"><a class="reference internal" href="Commands.html#commands"><span>Command</span></a> : <code class="docutils literal"><span class="pre">CreateSprite</span></code> or <span class="menuselection">Create ‣ Create Sprite</span></p>
</li>
<li><p class="first">In the Properties Window</p>
<ul class="simple">
<li>Set Name to: <code class="docutils literal"><span class="pre">Water</span></code></li>
<li>Set Archetype Name to: <code class="docutils literal"><span class="pre">Water</span></code></li>
<li>Under <a class="reference internal" href="../../ZeroManual/CodeReference/Reference/Transform.html#_CPPv29Transform" title="Transform"><code class="xref cpp cpp-type docutils literal"><span class="pre">Transform</span></code></a><ul>
<li>Set Translation to: <code class="docutils literal"><span class="pre">[3,</span> <span class="pre">0,</span> <span class="pre">0]</span></code></li>
<li>Set Scale to: <code class="docutils literal"><span class="pre">[0.5,</span> <span class="pre">0.5,</span> <span class="pre">0.5]</span></code></li>
</ul>
</li>
<li>Under <a class="reference internal" href="../../ZeroManual/CodeReference/Reference/Sprite.html#_CPPv26Sprite" title="Sprite"><code class="xref cpp cpp-type docutils literal"><span class="pre">Sprite</span></code></a><ul>
<li>Set Color to: <code class="docutils literal"><span class="pre">[R:</span> <span class="pre">128,</span> <span class="pre">G:</span> <span class="pre">128,</span> <span class="pre">B:</span> <span class="pre">255,</span> <span class="pre">A:</span> <span class="pre">1.0]</span></code>, <code class="docutils literal"><span class="pre">#8080FF</span></code></li>
<li>Set BlendMode to: <code class="docutils literal"><span class="pre">Additive</span></code></li>
<li>Set <a class="reference internal" href="../../ZeroManual/CodeReference/Reference/SpriteSource.html#_CPPv212SpriteSource" title="SpriteSource"><code class="xref cpp cpp-type docutils literal"><span class="pre">SpriteSource</span></code></a> to: <code class="docutils literal"><span class="pre">Circle</span></code></li>
</ul>
</li>
<li><a class="reference internal" href="AddComponent.html#addcomponent"><span>Add a RigidBody component</span></a></li>
<li><code class="docutils literal"><span class="pre">Left-click</span></code> the green <strong>Upload to Archetype</strong> button</li>
</ul>
<p><img alt="WaterArchetype" src="../../_images/WaterArchetype1.png" /></p>
</li>
</ul>
<p>Now that we&#8217;ve made our water archetype, we can delete this instance of it.</p>
<ul class="simple">
<li>Delete the Water object</li>
</ul>
<p>Now let&#8217;s make some code that actually fires this water out of the water cannon.</p>
<ul class="simple">
<li><a class="reference internal" href="ResourceAdding.html#resourceadding"><span>Add a new ZilchScript resource</span></a> named: <code class="docutils literal"><span class="pre">WaterCannon</span></code></li>
<li>Update your new script to look like this:</li>
</ul>
<div class="highlight-csharp"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">WaterCannon</span> <span class="p">:</span> <span class="n">ZilchComponent</span>
<span class="p">{</span>
  <span class="n">function</span> <span class="nf">Initialize</span><span class="p">(</span><span class="n">init</span> <span class="p">:</span> <span class="n">CogInitializer</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">Zero</span><span class="p">.</span><span class="n">Connect</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">Space</span><span class="p">,</span> <span class="n">Events</span><span class="p">.</span><span class="n">LogicUpdate</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="n">OnLogicUpdate</span><span class="p">);</span>
  <span class="p">}</span>


  <span class="n">function</span> <span class="nf">OnLogicUpdate</span><span class="p">(</span><span class="k">event</span> <span class="p">:</span> <span class="n">UpdateEvent</span><span class="p">)</span>
  <span class="p">{</span>

  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li>In the WaterCannon script<ul>
<li>Make the following set of additions to the code:</li>
</ul>
</li>
</ul>
<div class="highlight-csharp"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">WaterCannon</span> <span class="p">:</span> <span class="n">ZilchComponent</span>
<span class="p">{</span>
<span class="hll"><span class="na">  [Dependency]</span>
</span><span class="hll">  <span class="kt">var</span> <span class="n">Transform</span> <span class="p">:</span> <span class="n">Transform</span><span class="p">;</span>
</span>
  <span class="p">.</span>
  <span class="p">.</span>
  <span class="p">.</span>
</pre></div>
</div>
<p>Once again, we&#8217;ve specified that this <a class="reference internal" href="../../ZeroManual/CodeReference/Reference/Component.html#_CPPv29Component" title="Component"><code class="xref cpp cpp-type docutils literal"><span class="pre">component</span></code></a> has a
<strong>dependency</strong> on the <a class="reference internal" href="../../ZeroManual/CodeReference/Reference/Transform.html#_CPPv29Transform" title="Transform"><code class="xref cpp cpp-type docutils literal"><span class="pre">Transform</span></code></a> component, because we&#8217;re going to be
referring to it later in this component&#8217;s code.</p>
<div class="nextblock container">
Next:</div>
<div class="highlight-csharp"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">WaterCannon</span> <span class="p">:</span> <span class="n">ZilchComponent</span>
<span class="p">{</span>
<span class="na">  [Dependency]</span>
  <span class="kt">var</span> <span class="n">Transform</span> <span class="p">:</span> <span class="n">Transform</span><span class="p">;</span>


<span class="hll"><span class="na">  [Property]</span>
</span><span class="hll">  <span class="kt">var</span> <span class="n">WaterArchetype</span> <span class="p">:</span> <span class="n">Archetype</span> <span class="p">=</span> <span class="n">Archetype</span><span class="p">.</span><span class="n">Water</span><span class="p">;</span>
</span>
  <span class="p">.</span>
  <span class="p">.</span>
  <span class="p">.</span>
</pre></div>
</div>
<p>The <strong>WaterArchetype</strong> property specifies the <a class="reference internal" href="../../ZeroManual/CodeReference/Reference/Archetype.html#_CPPv29Archetype" title="Archetype"><code class="xref cpp cpp-type docutils literal"><span class="pre">archetype</span></code></a>
that we&#8217;ll use when we spawn water.</p>
<div class="nextblock container">
Next:</div>
<div class="highlight-csharp"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">WaterCannon</span> <span class="p">:</span> <span class="n">ZilchComponent</span>
<span class="p">{</span>
<span class="na">  [Dependency]</span>
  <span class="kt">var</span> <span class="n">Transform</span> <span class="p">:</span> <span class="n">Transform</span><span class="p">;</span>


<span class="na">  [Property]</span>
  <span class="kt">var</span> <span class="n">WaterArchetype</span> <span class="p">:</span> <span class="n">Archetype</span> <span class="p">=</span> <span class="n">Archetype</span><span class="p">.</span><span class="n">Water</span><span class="p">;</span>
<span class="hll"><span class="na">  [Property]</span>
</span><span class="hll">  <span class="kt">var</span> <span class="n">WaterSpeed</span> <span class="p">:</span> <span class="n">Real</span> <span class="p">=</span> <span class="m">20.0</span><span class="p">;</span>
</span>
  <span class="p">.</span>
  <span class="p">.</span>
  <span class="p">.</span>
</pre></div>
</div>
<p>The <strong>WaterSpeed</strong> property defines how fast the water will go.</p>
<div class="nextblock container">
Next:</div>
<div class="highlight-csharp"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">WaterCannon</span> <span class="p">:</span> <span class="n">ZilchComponent</span>
<span class="p">{</span>
<span class="na">  [Dependency]</span>
  <span class="kt">var</span> <span class="n">Transform</span> <span class="p">:</span> <span class="n">Transform</span><span class="p">;</span>


<span class="na">  [Property]</span>
  <span class="kt">var</span> <span class="n">WaterArchetype</span> <span class="p">:</span> <span class="n">Archetype</span> <span class="p">=</span> <span class="n">Archetype</span><span class="p">.</span><span class="n">Water</span><span class="p">;</span>
<span class="na">  [Property]</span>
  <span class="kt">var</span> <span class="n">WaterSpeed</span> <span class="p">:</span> <span class="n">Real</span> <span class="p">=</span> <span class="m">20.0</span><span class="p">;</span>
<span class="hll"><span class="na">  [Property]</span>
</span><span class="hll">  <span class="kt">var</span> <span class="n">Cannon</span> <span class="p">:</span> <span class="n">CogPath</span><span class="p">;</span>
</span>
  <span class="p">.</span>
  <span class="p">.</span>
  <span class="p">.</span>
</pre></div>
</div>
<p>The <strong>Cannon</strong> property is a <a class="reference internal" href="../../ZeroManual/CodeReference/Reference/CogPath.html#_CPPv27CogPath" title="CogPath"><code class="xref cpp cpp-type docutils literal"><span class="pre">CogPath</span></code></a> that we will soon point to the
player&#8217;s WaterCannon.</p>
<p>Let&#8217;s add this new component to the player.</p>
<ul class="simple">
<li><a class="reference internal" href="SelectObject.html#selectobject"><span>Select the Player object</span></a></li>
<li>In the Properties Window<ul>
<li><a class="reference internal" href="AddComponent.html#addcomponent"><span>Add a WaterCannon component</span></a></li>
<li>Under WaterCannon<ul>
<li><a class="reference internal" href="CogPaths.html#cogpaths"><span>Point the Cannon CogPath property to the WaterCannon Object</span></a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="SavingProject.html#savingproject"><span>Save the project</span></a></li>
</ul>
<p>Let&#8217;s continue to write the WaterCannon component.</p>
<ul class="simple">
<li>In the WaterCannon script<ul>
<li>Make the following additions to the code:</li>
</ul>
</li>
</ul>
<div class="highlight-csharp"><div class="highlight"><pre><span></span>  <span class="n">function</span> <span class="nf">OnLogicUpdate</span><span class="p">(</span><span class="k">event</span> <span class="p">:</span> <span class="n">UpdateEvent</span><span class="p">)</span>
  <span class="p">{</span>
<span class="hll">    <span class="k">if</span><span class="p">(</span><span class="n">Zero</span><span class="p">.</span><span class="n">Mouse</span><span class="p">.</span><span class="n">IsButtonDown</span><span class="p">(</span><span class="n">MouseButtons</span><span class="p">.</span><span class="n">Left</span><span class="p">))</span>
</span><span class="hll">    <span class="p">{</span>
</span><span class="hll">      <span class="k">this</span><span class="p">.</span><span class="n">Fire</span><span class="p">();</span>
</span><span class="hll">    <span class="p">}</span>
</span>  <span class="p">}</span>


<span class="hll">  <span class="n">function</span> <span class="nf">Fire</span><span class="p">()</span>
</span><span class="hll">  <span class="p">{</span>
</span><span class="hll">
</span><span class="hll">  <span class="p">}</span>
</span><span class="p">}</span>
</pre></div>
</div>
<p>This code makes it so that the <code class="docutils literal"><span class="pre">Fire</span></code> function is called every frame that the
left mouse button is held down. Now, let&#8217;s make the <code class="docutils literal"><span class="pre">Fire</span></code> function spawn
water <a class="reference internal" href="../../ZeroManual/CodeReference/Reference/Cog.html#_CPPv23Cog" title="Cog"><code class="xref cpp cpp-type docutils literal"><span class="pre">cogs</span></code></a>.</p>
<ul class="simple">
<li>In the WaterCannon script<ul>
<li>Make the following set of additions to the <code class="docutils literal"><span class="pre">Fire</span></code> function:</li>
</ul>
</li>
</ul>
<div class="highlight-csharp"><div class="highlight"><pre><span></span><span class="n">function</span> <span class="nf">Fire</span><span class="p">()</span>
<span class="p">{</span>
<span class="hll">  <span class="kt">var</span> <span class="n">waterPosition</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">Transform</span><span class="p">.</span><span class="n">WorldTranslation</span><span class="p">;</span>
</span><span class="hll">  <span class="kt">var</span> <span class="n">water</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">Space</span><span class="p">.</span><span class="n">CreateAtPosition</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">WaterArchetype</span><span class="p">,</span> <span class="n">waterPosition</span><span class="p">);</span>
</span><span class="p">}</span>
</pre></div>
</div>
<p>We start by making a variable called <code class="docutils literal"><span class="pre">waterPosition</span></code>, which is then used when
calling the <code class="docutils literal"><span class="pre">CreateAtPosition</span></code> function as the position at which to spawn a
water object. For now, the player&#8217;s position is a good enough place to start.</p>
<div class="nextblock container">
Next:</div>
<div class="highlight-csharp"><div class="highlight"><pre><span></span><span class="n">function</span> <span class="nf">Fire</span><span class="p">()</span>
<span class="p">{</span>
  <span class="kt">var</span> <span class="n">waterPosition</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">Transform</span><span class="p">.</span><span class="n">WorldTranslation</span><span class="p">;</span>
  <span class="kt">var</span> <span class="n">water</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">Space</span><span class="p">.</span><span class="n">CreateAtPosition</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">WaterArchetype</span><span class="p">,</span> <span class="n">waterPosition</span><span class="p">);</span>

<span class="hll">  <span class="n">water</span><span class="p">.</span><span class="n">RigidBody</span><span class="p">.</span><span class="n">Velocity</span> <span class="p">=</span> <span class="n">Real3</span><span class="p">.</span><span class="n">XAxis</span> <span class="p">*</span> <span class="k">this</span><span class="p">.</span><span class="n">WaterSpeed</span><span class="p">;</span>
</span><span class="p">}</span>
</pre></div>
</div>
<p>Next, we need to give the water a <strong>velocity</strong>. Otherwise, it will just sit
where it&#8217;s created. The code</p>
<p><code class="code docutils literal"><span class="pre">water.RigidBody.Velocity</span> <span class="pre">=</span> <span class="pre">Real3.XAxis</span> <span class="pre">*</span> <span class="pre">this.WaterSpeed;</span></code></p>
<p>is equivalent to saying, &#8220;the water should go in the direction of the positive
X axis at a speed of <code class="docutils literal"><span class="pre">this.WaterSpeed</span></code>.&#8221;</p>
<p>Let&#8217;s see how it looks so far.</p>
<ul class="simple">
<li><a class="reference internal" href="SavingProject.html#savingproject"><span>Save the project</span></a> and <a class="reference internal" href="RunTheGame.html#runthegame"><span>run the game</span></a></li>
</ul>
<p><img alt="WaterStreamToRight" src="../../_images/WaterStreamToRight1.gif" /></p>
<p>The player still rotates to face the mouse, but that isn&#8217;t having any effect on
the water&#8217;s trajectory. For that, we&#8217;re going to have to brush up a little on
our trigonometry &#8212; specifically, two of its most important functions:
<strong>Cosine</strong> and <strong>Sine</strong>.</p>
<ul class="simple">
<li><a class="reference internal" href="StopGame.html#stopgame"><span>Stop the Game</span></a></li>
</ul>
<div class="section" id="cosine-and-sine">
<h3>Cosine and Sine</h3>
<p>Let&#8217;s say we want our player to fire water in a given direction. The result
might look something like this:</p>
<p><img alt="PlayerAndFiringDirection" src="../../_images/PlayerAndFiringDirection1.png" /></p>
<p>The blue arrow shows the direction the water objects are flying. The player&#8217;s
rotation determines the firing direction &#8212; that is, their <em>angle of rotation
around the Z axis</em>.</p>
<p>Let&#8217;s imagine this firing angle as a part of an <strong>axis-aligned right triangle</strong>:</p>
<p><img alt="RightTriangle" src="../../_images/RightTriangle1.png" /></p>
<p>A right triangle is a triangle that has one right angle &#8212; an angle measuring
<strong>90 degrees</strong> (or <span class="math">\(\frac{\pi}{2}\)</span>). This one is axis-aligned: one of
its legs is parallel with the X axis (or, in this case, overlapping it), and the
other leg is parallel with the Y axis.</p>
<p>We can assign names to each side of this triangle:</p>
<p><img alt="RightTriangleSideNames" src="../../_images/RightTriangleSideNames1.png" /></p>
<ul class="simple">
<li>The leg across the triangle from our firing angle is called the <strong>opposite</strong>
side.</li>
<li>The other leg, next to the firing angle, is called the <strong>adjacent</strong> side.</li>
<li>The remaining side is opposite the right triangle&#8217;s right angle, and it is
known as the <strong>hypotenuse</strong>.<ul>
<li>The hypotenuse is <em>always the longest side in a right triangle</em>.</li>
</ul>
</li>
</ul>
<p>Note that these side names are <em>relative to the angle we have chosen</em>. If we
were talking about the other angle in this triangle &#8212; the one in the
upper-right &#8212; then what we have named &#8220;adjacent&#8221; here would actually be the
<em>opposite</em> side, and vice versa.</p>
<ul class="simple">
<li>We have chosen the lower-left angle to name the sides because that is the
angle that corresponds with the player&#8217;s rotation angle, which is what we&#8217;re
trying to find. In similar situations, it is very common for the horizontal
leg to be the <em>adjacent</em> side and the vertical leg to be the <em>opposite</em>
side.</li>
</ul>
<p>Recall from earlier in the lesson, when we used the <code class="docutils literal"><span class="pre">ATan2</span></code> function to find
the <code class="docutils literal"><span class="pre">mouseAngle</span></code>:</p>
<p><img alt="MouseAngleDiagram" src="../../_images/MouseAngleDiagram1.png" /></p>
<p>We&#8217;re basically trying to reproduce this vector, but in reverse, and with one
key difference: this <code class="docutils literal"><span class="pre">vectorToMouse</span></code> vector is the full <strong>difference vector</strong>
going from the player to the mouse pointer, so <em>its length is not necessarily
1</em>, whereas the vector we want to find is the <strong>direction vector</strong>, which <em>will</em>
necessarily have a length of 1.</p>
<p>Note how, in the above diagram, the <code class="docutils literal"><span class="pre">vectorToMouse</span></code> has an X part and a Y
part: <code class="docutils literal"><span class="pre">vectorToMouse.X</span></code> and <code class="docutils literal"><span class="pre">vectorToMouse.Y</span></code>. The combination of these two
parts is the original vector itself. Another way of looking at it is that the
full <code class="docutils literal"><span class="pre">vectorToMouse</span></code> is equal to the sum of two <em>component vectors</em>:
<code class="docutils literal"><span class="pre">[x,</span> <span class="pre">0,</span> <span class="pre">0]</span></code> and <code class="docutils literal"><span class="pre">[0,</span> <span class="pre">y,</span> <span class="pre">0]</span></code>, where <code class="docutils literal"><span class="pre">x</span></code> equals <code class="docutils literal"><span class="pre">vectorToMouse.X</span></code> and
<code class="docutils literal"><span class="pre">y</span></code> equals <code class="docutils literal"><span class="pre">vectorToMouse.Y</span></code>.</p>
<p>Back to our triangle: if we had the lengths of the <strong>adjacent</strong> and <strong>opposite</strong>
sides, we would be able to combine them to find our firing direction vector.</p>
<p>This is where trigonometry comes in handy. Given any right triangle, <strong>the ratio
of the length of the leg</strong> <span class="bolditalic">adjacent</span> <strong>to a given angle to the length of
the hypotenuse</strong> is called the <span class="bolditalic">cosine</span> of the angle. Likewise, <strong>the ratio
of the length of the leg</strong> <span class="bolditalic">opposite</span> <strong>to a given angle to the length of
the hypotenuse</strong> is called the <span class="bolditalic">sine</span> of the angle. Cosine and sine are
typically abbreviated as <strong>cos</strong> and <strong>sin</strong>, respectively.</p>
<p><img alt="IntroducingCosineAndSine" src="../../_images/IntroducingCosineAndSine1.png" /></p>
<p>Once again:</p>
<ul class="simple">
<li>The length of the leg adjacent to an angle divided by the length of the
hypotenuse is that angle&#8217;s <em>cosine</em></li>
</ul>
<div class="math">
\[\begin{split}\cos(firingAngle) &amp;= \frac{adjacent}{hypotenuse}\end{split}\]</div>
<ul class="simple">
<li>The length of the leg opposite an angle divided by the length of the
hypotenuse is that angle&#8217;s <em>sine</em></li>
</ul>
<div class="math">
\[\begin{split}\sin(firingAngle) &amp;= \frac{opposite}{hypotenuse}\end{split}\]</div>
<p>Looking once again at the mouse angle diagram...</p>
<p><img alt="MouseAngleDiagram" src="../../_images/MouseAngleDiagram1.png" /></p>
<p>...we can see that the <strong>X part</strong> of the vector is the <strong>adjacent</strong> leg to the
mouse angle, and the <strong>Y part</strong> is the <strong>opposite</strong> leg.</p>
<p>Likewise, with the way we have constructed our right triangle, the <strong>cosine</strong> of
the firing angle is equal to the <em>X part of the direction vector divided by the
vector&#8217;s length</em>, and the <strong>sine</strong> of the firing angle equals the <em>Y part
divided by the length</em>.</p>
<p>Taking this one step further, we can solve for each leg in terms of the length
of the hypotenuse and the cosine and sine of our angle:</p>
<ul class="simple">
<li>The length of the leg adjacent to an angle is equal to the length of the
hypotenuse multiplied by that angle&#8217;s <em>cosine</em></li>
</ul>
<div class="math">
\[\begin{split}adjacent&amp;=hypotenuse*\cos(firingAngle)\end{split}\]</div>
<ul class="simple">
<li>The length of the leg opposite to an angle is equal to the length of the
hypotenuse multiplied by that angle&#8217;s <em>sine</em></li>
</ul>
<div class="math">
\[\begin{split}opposite&amp;=hypotenuse*\sin(firingAngle)\end{split}\]</div>
<p><img alt="SideLengths" src="../../_images/SideLengths1.png" /></p>
<p><strong>Since direction vectors always have a length of exactly 1</strong>, the triangle&#8217;s
hypotenuse has a length of 1. Multiplying by 1 has no effect, so we can deduce
that the direction vector&#8217;s X part is <code class="docutils literal"><span class="pre">Math.Cos(firingAngle)</span></code>, and its Y part
is <code class="docutils literal"><span class="pre">Math.Sin(firingAngle)</span></code>. Of course, the direction vector is a
<code class="xref cpp cpp-type docutils literal"><span class="pre">Real3</span></code>, so it has a Z part as well. However, because this is a 2D
game, and we are only firing along the <em>XY plane</em>, the direction vector&#8217;s Z part
is equal to <strong>0</strong>.</p>
<p>Thus:</p>
<div class="math">
\[\widehat{firingDirection}=\left[\cos(firingAngle),\sin(firingAngle),0\right]\]</div>
<p>Here&#8217;s another way of looking at it. Suppose we have a vector of fixed length,
like, say, a direction vector (of length 1, of course). Suppose we <em>rotate that
vector around the origin</em>, so that its angle of rotation is constantly changing.
Let&#8217;s visualize the cosine and sine of that rotation angle:</p>
<p><img alt="CosineAndSine" src="../../_images/CosineAndSine1.gif" /></p>
<p>See how the cosine of the angle is always the X part of the vector, and the sine
is always the Y part? This is what we want to do with our player&#8217;s rotation
angle.</p>
<p>Now we can finally use our firing angle to find our firing direction.</p>
<ul class="simple">
<li>In the WaterCannon script<ul>
<li>Make the following set of additions to the <code class="docutils literal"><span class="pre">Fire</span></code> function:</li>
</ul>
</li>
</ul>
<div class="highlight-csharp"><div class="highlight"><pre><span></span><span class="n">function</span> <span class="nf">Fire</span><span class="p">()</span>
<span class="p">{</span>
  <span class="kt">var</span> <span class="n">waterPosition</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">Transform</span><span class="p">.</span><span class="n">WorldTranslation</span><span class="p">;</span>
  <span class="kt">var</span> <span class="n">water</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">Space</span><span class="p">.</span><span class="n">CreateAtPosition</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">WaterArchetype</span><span class="p">,</span> <span class="n">waterPosition</span><span class="p">);</span>

<span class="hll">  <span class="c1">// The firing angle is equal to the rotation angle about the Z axis</span>
</span><span class="hll">  <span class="kt">var</span> <span class="n">firingAngle</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">Transform</span><span class="p">.</span><span class="n">EulerAngles</span><span class="p">.</span><span class="n">Z</span><span class="p">;</span>
</span>
  <span class="n">water</span><span class="p">.</span><span class="n">RigidBody</span><span class="p">.</span><span class="n">Velocity</span> <span class="p">=</span> <span class="n">Real3</span><span class="p">.</span><span class="n">XAxis</span> <span class="p">*</span> <span class="k">this</span><span class="p">.</span><span class="n">WaterSpeed</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">firingAngle</span></code> we get from the player&#8217;s Euler angles is in <strong>radians</strong>.
This is handy, because we&#8217;re going to use it in the <code class="docutils literal"><span class="pre">Math.Cos</span></code> and
<code class="docutils literal"><span class="pre">Math.Sin</span></code> functions, <em>both of which expect an angle in radians</em>.</p>
<div class="nextblock container">
Next:</div>
<div class="highlight-csharp"><div class="highlight"><pre><span></span><span class="n">function</span> <span class="nf">Fire</span><span class="p">()</span>
<span class="p">{</span>
  <span class="kt">var</span> <span class="n">waterPosition</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">Transform</span><span class="p">.</span><span class="n">WorldTranslation</span><span class="p">;</span>
  <span class="kt">var</span> <span class="n">water</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">Space</span><span class="p">.</span><span class="n">CreateAtPosition</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">WaterArchetype</span><span class="p">,</span> <span class="n">waterPosition</span><span class="p">);</span>

  <span class="c1">// The firing angle is equal to the rotation angle about the Z axis</span>
  <span class="kt">var</span> <span class="n">firingAngle</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">Transform</span><span class="p">.</span><span class="n">EulerAngles</span><span class="p">.</span><span class="n">Z</span><span class="p">;</span>

<span class="hll">  <span class="c1">// The length of a direction vector is 1, so we do not need to multiply</span>
</span><span class="hll">  <span class="c1">// the cosine and sine of the angle by anything to get the x and y parts</span>
</span><span class="hll">  <span class="kt">var</span> <span class="n">xPart</span> <span class="p">=</span> <span class="n">Math</span><span class="p">.</span><span class="n">Cos</span><span class="p">(</span><span class="n">firingAngle</span><span class="p">);</span>
</span><span class="hll">  <span class="kt">var</span> <span class="n">yPart</span> <span class="p">=</span> <span class="n">Math</span><span class="p">.</span><span class="n">Sin</span><span class="p">(</span><span class="n">firingAngle</span><span class="p">);</span>
</span><span class="hll">  <span class="c1">// This vector does not extend at all into the Z direction</span>
</span><span class="hll">  <span class="kt">var</span> <span class="n">zPart</span> <span class="p">=</span> <span class="m">0.0</span><span class="p">;</span>
</span>
  <span class="n">water</span><span class="p">.</span><span class="n">RigidBody</span><span class="p">.</span><span class="n">Velocity</span> <span class="p">=</span> <span class="n">Real3</span><span class="p">.</span><span class="n">XAxis</span> <span class="p">*</span> <span class="k">this</span><span class="p">.</span><span class="n">WaterSpeed</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Next, we use our trig functions to find the X and Y parts of the direction
vector. As this is a 2D game, the Z part of the vector is <strong>0</strong>.</p>
<div class="nextblock container">
Next:</div>
<div class="highlight-csharp"><div class="highlight"><pre><span></span><span class="n">function</span> <span class="nf">Fire</span><span class="p">()</span>
<span class="p">{</span>
  <span class="kt">var</span> <span class="n">waterPosition</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">Transform</span><span class="p">.</span><span class="n">WorldTranslation</span><span class="p">;</span>
  <span class="kt">var</span> <span class="n">water</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">Space</span><span class="p">.</span><span class="n">CreateAtPosition</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">WaterArchetype</span><span class="p">,</span> <span class="n">waterPosition</span><span class="p">);</span>

  <span class="c1">// The firing angle is equal to the rotation angle about the Z axis</span>
  <span class="kt">var</span> <span class="n">firingAngle</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">Transform</span><span class="p">.</span><span class="n">EulerAngles</span><span class="p">.</span><span class="n">Z</span><span class="p">;</span>

  <span class="c1">// The length of a direction vector is 1, so we do not need to multiply</span>
  <span class="c1">// the cosine and sine of the angle by anything to get the x and y parts</span>
  <span class="kt">var</span> <span class="n">xPart</span> <span class="p">=</span> <span class="n">Math</span><span class="p">.</span><span class="n">Cos</span><span class="p">(</span><span class="n">firingAngle</span><span class="p">);</span>
  <span class="kt">var</span> <span class="n">yPart</span> <span class="p">=</span> <span class="n">Math</span><span class="p">.</span><span class="n">Sin</span><span class="p">(</span><span class="n">firingAngle</span><span class="p">);</span>
  <span class="c1">// This vector does not extend at all into the Z direction</span>
  <span class="kt">var</span> <span class="n">zPart</span> <span class="p">=</span> <span class="m">0.0</span><span class="p">;</span>

<span class="hll">  <span class="kt">var</span> <span class="n">firingDirection</span> <span class="p">=</span> <span class="n">Real3</span><span class="p">(</span><span class="n">xPart</span><span class="p">,</span> <span class="n">yPart</span><span class="p">,</span> <span class="n">zPart</span><span class="p">);</span>
</span>
  <span class="n">water</span><span class="p">.</span><span class="n">RigidBody</span><span class="p">.</span><span class="n">Velocity</span> <span class="p">=</span> <span class="n">Real3</span><span class="p">.</span><span class="n">XAxis</span> <span class="p">*</span> <span class="k">this</span><span class="p">.</span><span class="n">WaterSpeed</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The next step is to create a <code class="xref cpp cpp-type docutils literal"><span class="pre">Real3</span></code> vector from its constituent X, Y,
and Z parts.</p>
<ul class="simple">
<li>In the WaterCannon script<ul>
<li>Make the following modification to the <code class="docutils literal"><span class="pre">Fire</span></code> function:</li>
</ul>
</li>
</ul>
<div class="highlight-csharp"><div class="highlight"><pre><span></span><span class="n">function</span> <span class="nf">Fire</span><span class="p">()</span>
<span class="p">{</span>
  <span class="kt">var</span> <span class="n">waterPosition</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">Transform</span><span class="p">.</span><span class="n">WorldTranslation</span><span class="p">;</span>
  <span class="kt">var</span> <span class="n">water</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">Space</span><span class="p">.</span><span class="n">CreateAtPosition</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">WaterArchetype</span><span class="p">,</span> <span class="n">waterPosition</span><span class="p">);</span>

  <span class="c1">// The firing angle is equal to the rotation angle about the Z axis</span>
  <span class="kt">var</span> <span class="n">firingAngle</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">Transform</span><span class="p">.</span><span class="n">EulerAngles</span><span class="p">.</span><span class="n">Z</span><span class="p">;</span>

  <span class="c1">// The length of a direction vector is 1, so we do not need to multiply</span>
  <span class="c1">// the cosine and sine of the angle by anything to get the x and y parts</span>
  <span class="kt">var</span> <span class="n">xPart</span> <span class="p">=</span> <span class="n">Math</span><span class="p">.</span><span class="n">Cos</span><span class="p">(</span><span class="n">firingAngle</span><span class="p">);</span>
  <span class="kt">var</span> <span class="n">yPart</span> <span class="p">=</span> <span class="n">Math</span><span class="p">.</span><span class="n">Sin</span><span class="p">(</span><span class="n">firingAngle</span><span class="p">);</span>
  <span class="c1">// This vector does not extend at all into the Z direction</span>
  <span class="kt">var</span> <span class="n">zPart</span> <span class="p">=</span> <span class="m">0.0</span><span class="p">;</span>

  <span class="kt">var</span> <span class="n">firingDirection</span> <span class="p">=</span> <span class="n">Real3</span><span class="p">(</span><span class="n">xPart</span><span class="p">,</span> <span class="n">yPart</span><span class="p">,</span> <span class="n">zPart</span><span class="p">);</span>

<span class="hll">  <span class="n">water</span><span class="p">.</span><span class="n">RigidBody</span><span class="p">.</span><span class="n">Velocity</span> <span class="p">=</span> <span class="n">firingDirection</span> <span class="p">*</span> <span class="k">this</span><span class="p">.</span><span class="n">WaterSpeed</span><span class="p">;</span>
</span><span class="p">}</span>
</pre></div>
</div>
<p>Just like before,</p>
<p><code class="code docutils literal"><span class="pre">water.RigidBody.Velocity</span> <span class="pre">=</span> <span class="pre">firingDirection</span> <span class="pre">*</span> <span class="pre">this.WaterSpeed;</span></code></p>
<p>means, &#8220;the water should go in the direction <code class="docutils literal"><span class="pre">firingDirection</span></code> at a speed
of <code class="docutils literal"><span class="pre">this.WaterSpeed</span></code>.&#8221; Remember, the direction vector has a <em>length of
exactly 1</em>, so we <strong>scale the direction vector by the desired speed</strong> to get
the water&#8217;s velocity vector.</p>
<p>Let&#8217;s try it out.</p>
<ul class="simple">
<li><a class="reference internal" href="SavingProject.html#savingproject"><span>Save the project</span></a> and <a class="reference internal" href="RunTheGame.html#runthegame"><span>run the game</span></a></li>
</ul>
<p><img alt="WaterStreamFollowingMouse" src="../../_images/WaterStreamFollowingMouse1.gif" /></p>
<p>Now you can move the mouse to aim the water stream.</p>
</div>
</div>
<div class="section" id="improvements">
<h2>Improvements</h2>
<p>At this point, there are two improvements to make, one small and one not so
small.</p>
<ul class="simple">
<li><a class="reference internal" href="StopGame.html#stopgame"><span>Stop the Game</span></a></li>
</ul>
<div class="section" id="small-improvement">
<h3>Small Improvement</h3>
<p>Currently, the water is coming out of the center of our player, not the water
cannon. We can easily fix this.</p>
<ul class="simple">
<li>In the WaterCannon script<ul>
<li>Make the following modification to the <code class="docutils literal"><span class="pre">Fire</span></code> function:</li>
</ul>
</li>
</ul>
<div class="highlight-csharp"><div class="highlight"><pre><span></span><span class="n">function</span> <span class="nf">Fire</span><span class="p">()</span>
<span class="p">{</span>
<span class="hll">  <span class="kt">var</span> <span class="n">waterPosition</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">Cannon</span><span class="p">.</span><span class="n">Cog</span><span class="p">.</span><span class="n">Transform</span><span class="p">.</span><span class="n">WorldTranslation</span><span class="p">;</span>
</span><span class="hll">  <span class="n">waterPosition</span><span class="p">.</span><span class="n">Z</span> <span class="p">=</span> <span class="m">0.0</span><span class="p">;</span>
</span>  <span class="kt">var</span> <span class="n">water</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">Space</span><span class="p">.</span><span class="n">CreateAtPosition</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">WaterArchetype</span><span class="p">,</span> <span class="n">waterPosition</span><span class="p">);</span>

  <span class="c1">// The firing angle is equal to the rotation angle about the Z axis</span>
  <span class="kt">var</span> <span class="n">firingAngle</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">Transform</span><span class="p">.</span><span class="n">EulerAngles</span><span class="p">.</span><span class="n">Z</span><span class="p">;</span>

  <span class="c1">// The length of a direction vector is 1, so we do not need to multiply</span>
  <span class="c1">// the cosine and sine of the angle by anything to get the x and y parts</span>
  <span class="kt">var</span> <span class="n">xPart</span> <span class="p">=</span> <span class="n">Math</span><span class="p">.</span><span class="n">Cos</span><span class="p">(</span><span class="n">firingAngle</span><span class="p">);</span>
  <span class="kt">var</span> <span class="n">yPart</span> <span class="p">=</span> <span class="n">Math</span><span class="p">.</span><span class="n">Sin</span><span class="p">(</span><span class="n">firingAngle</span><span class="p">);</span>
  <span class="c1">// This vector does not extend at all into the Z direction</span>
  <span class="kt">var</span> <span class="n">zPart</span> <span class="p">=</span> <span class="m">0.0</span><span class="p">;</span>

  <span class="kt">var</span> <span class="n">firingDirection</span> <span class="p">=</span> <span class="n">Real3</span><span class="p">(</span><span class="n">xPart</span><span class="p">,</span> <span class="n">yPart</span><span class="p">,</span> <span class="n">zPart</span><span class="p">);</span>

  <span class="n">water</span><span class="p">.</span><span class="n">RigidBody</span><span class="p">.</span><span class="n">Velocity</span> <span class="p">=</span> <span class="n">firingDirection</span> <span class="p">*</span> <span class="k">this</span><span class="p">.</span><span class="n">WaterSpeed</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Here&#8217;s what we did:</p>
<ul class="simple">
<li>We&#8217;re now setting the water&#8217;s starting position to be equal to the
WorldTranslation of the cannon cog instead of the WorldTranslation of
the player.<ul>
<li>However, when we made the cannon, we moved it a little bit into the
positive Z direction to avoid Z-fighting between its
<a class="reference internal" href="../../ZeroManual/CodeReference/Reference/Sprite.html#_CPPv26Sprite" title="Sprite"><code class="xref cpp cpp-type docutils literal"><span class="pre">sprite</span></code></a> and the player&#8217;s sprite, so we&#8217;re zeroing out
the Z part of the water&#8217;s position before we use it.</li>
</ul>
</li>
<li><a class="reference internal" href="SavingProject.html#savingproject"><span>Save the project</span></a> and <a class="reference internal" href="RunTheGame.html#runthegame"><span>run the game</span></a></li>
</ul>
<p>If we were to shoot water, we would notice that it now comes from the cannon
instead of the center of the player.</p>
<ul class="simple">
<li><a class="reference internal" href="StopGame.html#stopgame"><span>Stop the Game</span></a></li>
</ul>
</div>
<div class="section" id="not-so-small-improvement">
<h3>Not-So Small Improvement</h3>
<p>Currently, we&#8217;re creating a large number of water cogs &#8212; dozens every
second, in fact &#8212; when we hold down the mouse button. There&#8217;s nothing wrong
with that in itself, but the problem is that we&#8217;re <em>not destroying them</em>. If one
were to run the game as it is now, one might notice the frame rate dropping a
bit after a while of spraying the water cannon, because the engine continues to
keep track of every bit of water it makes, even after they leave the screen.</p>
<p>In general, when making projectiles like the water in this game, it is always
wise to make sure that there is some sure-fire way that they will eventually be
destroyed. There are potentially many ways of doing this, but one of the most
reliable methods is with a <strong>TimedDeath</strong> component, which we can easily write.</p>
<div class="section" id="the-timeddeath-component">
<h4>The TimedDeath Component</h4>
<ul class="simple">
<li><a class="reference internal" href="ResourceAdding.html#resourceadding"><span>Add a new ZilchScript resource</span></a> named: <code class="docutils literal"><span class="pre">TimedDeath</span></code></li>
<li>Update your new script to look like this:</li>
</ul>
<div class="highlight-csharp"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">TimedDeath</span> <span class="p">:</span> <span class="n">ZilchComponent</span>
<span class="p">{</span>
<span class="na">  [Property]</span>
  <span class="kt">var</span> <span class="n">Lifetime</span> <span class="p">:</span> <span class="n">Real</span> <span class="p">=</span> <span class="m">5.0</span><span class="p">;</span>

  <span class="kt">var</span> <span class="n">Timer</span> <span class="p">:</span> <span class="n">Real</span><span class="p">;</span>


  <span class="n">function</span> <span class="nf">Initialize</span><span class="p">(</span><span class="n">init</span> <span class="p">:</span> <span class="n">CogInitializer</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="n">Timer</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">Lifetime</span><span class="p">;</span>

    <span class="n">Zero</span><span class="p">.</span><span class="n">Connect</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">Space</span><span class="p">,</span> <span class="n">Events</span><span class="p">.</span><span class="n">LogicUpdate</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="n">OnLogicUpdate</span><span class="p">);</span>
  <span class="p">}</span>


  <span class="n">function</span> <span class="nf">OnLogicUpdate</span><span class="p">(</span><span class="k">event</span> <span class="p">:</span> <span class="n">UpdateEvent</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="n">Timer</span> <span class="p">-=</span> <span class="k">event</span><span class="p">.</span><span class="n">Dt</span><span class="p">;</span>

    <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">Timer</span> <span class="p">&lt;=</span> <span class="m">0.0</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="n">Owner</span><span class="p">.</span><span class="n">Destroy</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Any cog with this component will automatically destroy itself after its
<code class="docutils literal"><span class="pre">Lifetime</span></code> expires, which we have defined as five seconds by default.</p>
<ul class="simple">
<li>In the Library Window<ul>
<li>Under the Archetype tag<ul>
<li>Select the archetype called <code class="docutils literal"><span class="pre">Water</span></code></li>
</ul>
</li>
</ul>
</li>
<li>In the Properties Window<ul>
<li><a class="reference internal" href="AddComponent.html#addcomponent"><span>Add a TimedDeath component</span></a></li>
<li><code class="docutils literal"><span class="pre">Left-click</span></code> the green <strong>Upload to Archetype</strong> button</li>
</ul>
</li>
</ul>
<p>Now we&#8217;re free to shoot as much water as we like, and we can be sure that it
will all be destroyed shortly afterward.</p>
</div>
</div>
</div>
<div class="section" id="shooting-targets">
<h2>Shooting Targets</h2>
<p>It&#8217;s not much fun to shoot water when you don&#8217;t have anything to shoot.
Let&#8217;s make a target to shoot at.</p>
<ul class="simple">
<li><a class="reference internal" href="Commands.html#commands"><span>Command</span></a> : <code class="docutils literal"><span class="pre">CreateSprite</span></code> or <span class="menuselection">Create ‣ Create Sprite</span></li>
<li>In the Properties Window<ul>
<li>Set Name to: <code class="docutils literal"><span class="pre">Target</span></code></li>
<li>Set Archetype Name to: <code class="docutils literal"><span class="pre">Target</span></code></li>
<li>Under <a class="reference internal" href="../../ZeroManual/CodeReference/Reference/Transform.html#_CPPv29Transform" title="Transform"><code class="xref cpp cpp-type docutils literal"><span class="pre">Transform</span></code></a><ul>
<li>Set Translation to: <code class="docutils literal"><span class="pre">[8,</span> <span class="pre">0,</span> <span class="pre">0]</span></code></li>
</ul>
</li>
<li>Under <a class="reference internal" href="../../ZeroManual/CodeReference/Reference/Sprite.html#_CPPv26Sprite" title="Sprite"><code class="xref cpp cpp-type docutils literal"><span class="pre">Sprite</span></code></a><ul>
<li>Set Color to: <code class="docutils literal"><span class="pre">[R:</span> <span class="pre">255,</span> <span class="pre">G:</span> <span class="pre">255,</span> <span class="pre">B:</span> <span class="pre">0,</span> <span class="pre">A:</span> <span class="pre">1.0]</span></code>, <code class="docutils literal"><span class="pre">#FFFF00</span></code></li>
<li>Set <a class="reference internal" href="../../ZeroManual/CodeReference/Reference/SpriteSource.html#_CPPv212SpriteSource" title="SpriteSource"><code class="xref cpp cpp-type docutils literal"><span class="pre">SpriteSource</span></code></a> to: <code class="docutils literal"><span class="pre">CircleBordered</span></code></li>
</ul>
</li>
<li><a class="reference internal" href="AddComponent.html#addcomponent"><span>Add a SphereCollider component</span></a></li>
<li>Under <a class="reference internal" href="../../ZeroManual/CodeReference/Reference/SphereCollider.html#_CPPv214SphereCollider" title="SphereCollider"><code class="xref cpp cpp-type docutils literal"><span class="pre">SphereCollider</span></code></a><ul>
<li>Set Radius to: <code class="docutils literal"><span class="pre">0.5</span></code></li>
</ul>
</li>
<li><code class="docutils literal"><span class="pre">Left-click</span></code> the green <strong>Upload to Archetype</strong> button</li>
</ul>
</li>
</ul>
<p>Let&#8217;s try shooting our new target.</p>
<ul class="simple">
<li><a class="reference internal" href="SavingProject.html#savingproject"><span>Save the project</span></a> and <a class="reference internal" href="RunTheGame.html#runthegame"><span>run the game</span></a></li>
</ul>
<p>Nothing&#8217;s happening &#8212; the water goes right through the target. This is because
we neglected to put a collider on the water archetype.</p>
<ul class="simple">
<li><a class="reference internal" href="StopGame.html#stopgame"><span>Stop the Game</span></a></li>
<li>In the Library Window<ul>
<li>Under the Archetype tag<ul>
<li>Select the archetype called <code class="docutils literal"><span class="pre">Water</span></code></li>
</ul>
</li>
</ul>
</li>
<li>In the Properties Window<ul>
<li><a class="reference internal" href="AddComponent.html#addcomponent"><span>Add a SphereCollider component</span></a></li>
<li>Under <a class="reference internal" href="../../ZeroManual/CodeReference/Reference/SphereCollider.html#_CPPv214SphereCollider" title="SphereCollider"><code class="xref cpp cpp-type docutils literal"><span class="pre">SphereCollider</span></code></a><ul>
<li>Set Radius to: <code class="docutils literal"><span class="pre">0.5</span></code></li>
</ul>
</li>
<li><code class="docutils literal"><span class="pre">Left-click</span></code> the green <strong>Upload to Archetype</strong> button</li>
</ul>
</li>
</ul>
<p>Let&#8217;s try it again.</p>
<ul class="simple">
<li><a class="reference internal" href="SavingProject.html#savingproject"><span>Save the project</span></a> and <a class="reference internal" href="RunTheGame.html#runthegame"><span>run the game</span></a></li>
</ul>
<p><img alt="WaterColliding" src="../../_images/WaterColliding1.gif" /></p>
<p>The water now collides with the target &#8212; and with other water cogs. Let&#8217;s make
it so that the water&#8217;s colliders are <strong>ghosts</strong>, so that they will <em>not undergo
collision resolution</em>, though they will still allow collision <strong>detection</strong>.</p>
<ul class="simple">
<li><a class="reference internal" href="StopGame.html#stopgame"><span>Stop the Game</span></a></li>
<li>In the Library Window<ul>
<li>Under the Archetype tag<ul>
<li>Select the archetype called <code class="docutils literal"><span class="pre">Water</span></code></li>
</ul>
</li>
</ul>
</li>
<li>In the Properties Window<ul>
<li>Under <a class="reference internal" href="../../ZeroManual/CodeReference/Reference/SphereCollider.html#_CPPv214SphereCollider" title="SphereCollider"><code class="xref cpp cpp-type docutils literal"><span class="pre">SphereCollider</span></code></a><ul>
<li>Set Ghost to: <code class="docutils literal"><span class="pre">true</span></code></li>
</ul>
</li>
<li><code class="docutils literal"><span class="pre">Left-click</span></code> the green <strong>Upload to Archetype</strong> button</li>
</ul>
</li>
</ul>
<p>Now let&#8217;s make the target react in a more interesting manner. A water cannon
should be able to get something soaking wet, so let&#8217;s make that happen.</p>
<ul class="simple">
<li><a class="reference internal" href="ResourceAdding.html#resourceadding"><span>Add a new ZilchScript resource</span></a> named: <code class="docutils literal"><span class="pre">SoakOnCollide</span></code></li>
<li>Update your new script to look like this:</li>
</ul>
<div class="highlight-csharp"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SoakOnCollide</span> <span class="p">:</span> <span class="n">ZilchComponent</span>
<span class="p">{</span>
<span class="hll">  <span class="n">sends</span> <span class="n">Soak</span> <span class="p">:</span> <span class="n">ZilchEvent</span><span class="p">;</span>
</span>

  <span class="n">function</span> <span class="nf">Initialize</span><span class="p">(</span><span class="n">init</span> <span class="p">:</span> <span class="n">CogInitializer</span><span class="p">)</span>
  <span class="p">{</span>
<span class="hll">    <span class="n">Zero</span><span class="p">.</span><span class="n">Connect</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">Owner</span><span class="p">,</span> <span class="n">Events</span><span class="p">.</span><span class="n">CollisionStarted</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="n">OnCollisionStarted</span><span class="p">);</span>
</span>  <span class="p">}</span>


<span class="hll">  <span class="n">function</span> <span class="nf">OnCollisionStarted</span><span class="p">(</span><span class="k">event</span> <span class="p">:</span> <span class="n">CollisionEvent</span><span class="p">)</span>
</span><span class="hll">  <span class="p">{</span>
</span><span class="hll">    <span class="k">event</span><span class="p">.</span><span class="n">OtherObject</span><span class="p">.</span><span class="n">DispatchEvent</span><span class="p">(</span><span class="n">Events</span><span class="p">.</span><span class="n">Soak</span><span class="p">,</span> <span class="n">ZilchEvent</span><span class="p">());</span>
</span><span class="hll">  <span class="p">}</span>
</span><span class="p">}</span>
</pre></div>
</div>
<p>This is a pretty simple component:</p>
<ul class="simple">
<li>It dispatches the <strong>Soak</strong> custom event to whatever it collides with.<ul>
<li>Note that, because the <strong>Soak</strong> event requires no special data or
functionality beyond a bare <code class="xref cpp cpp-type docutils literal"><span class="pre">ZilchEvent</span></code> object, we can just
create the ZilchEvent right inside the <code class="docutils literal"><span class="pre">DispatchEvent</span></code> function call.</li>
</ul>
</li>
</ul>
<p>This makes it perfect for our water archetype.</p>
<ul class="simple">
<li>In the Library Window<ul>
<li>Under the Archetype tag<ul>
<li>Select the archetype called <code class="docutils literal"><span class="pre">Water</span></code></li>
</ul>
</li>
</ul>
</li>
<li>In the Properties Window<ul>
<li><a class="reference internal" href="AddComponent.html#addcomponent"><span>Add a SoakOnCollide component</span></a></li>
<li><code class="docutils literal"><span class="pre">Left-click</span></code> the green <strong>Upload to Archetype</strong> button</li>
</ul>
</li>
</ul>
<p>When the target gets wet, we&#8217;ll make it add a layer of water on top of itself.
Every time it gets hit by water from the cannon, it will add another layer.
Let&#8217;s make this water layer archetype now.</p>
<ul class="simple">
<li><a class="reference internal" href="Commands.html#commands"><span>Command</span></a> : <code class="docutils literal"><span class="pre">CreateSprite</span></code> or <span class="menuselection">Create ‣ Create Sprite</span></li>
<li>In the Properties Window<ul>
<li>Set Name to: <code class="docutils literal"><span class="pre">WaterLayer</span></code></li>
<li>Set Archetype Name to: <code class="docutils literal"><span class="pre">WaterLayer</span></code></li>
<li>Under <a class="reference internal" href="../../ZeroManual/CodeReference/Reference/Transform.html#_CPPv29Transform" title="Transform"><code class="xref cpp cpp-type docutils literal"><span class="pre">Transform</span></code></a><ul>
<li>Set Scale to: <code class="docutils literal"><span class="pre">[1.25,</span> <span class="pre">1.25,</span> <span class="pre">1.25]</span></code></li>
</ul>
</li>
<li>Under <a class="reference internal" href="../../ZeroManual/CodeReference/Reference/Sprite.html#_CPPv26Sprite" title="Sprite"><code class="xref cpp cpp-type docutils literal"><span class="pre">Sprite</span></code></a><ul>
<li>Set Color to: <code class="docutils literal"><span class="pre">[R:</span> <span class="pre">8,</span> <span class="pre">G:</span> <span class="pre">8,</span> <span class="pre">B:</span> <span class="pre">16,</span> <span class="pre">A:</span> <span class="pre">1.0]</span></code>, <code class="docutils literal"><span class="pre">#080810</span></code></li>
<li>Set BlendMode to: <code class="docutils literal"><span class="pre">Additive</span></code></li>
<li>Set SpriteSource to: <code class="docutils literal"><span class="pre">Circle</span></code></li>
</ul>
</li>
<li><a class="reference internal" href="AddComponent.html#addcomponent"><span>Add a TimedDeath component</span></a></li>
<li><code class="docutils literal"><span class="pre">Left-click</span></code> the green <strong>Upload to Archetype</strong> button</li>
</ul>
</li>
</ul>
<p>Now that we&#8217;ve created our water layer archetype, we can delete this instance of
it.</p>
<ul class="simple">
<li>Delete the WaterLayer object</li>
</ul>
<p>Now let&#8217;s make a component that will allow the target to create these water
layers.</p>
<ul class="simple">
<li><a class="reference internal" href="ResourceAdding.html#resourceadding"><span>Add a new ZilchScript resource</span></a> named: <code class="docutils literal"><span class="pre">SoakResponse</span></code></li>
<li>Update your new script to look like this:</li>
</ul>
<div class="highlight-csharp"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SoakResponse</span> <span class="p">:</span> <span class="n">ZilchComponent</span>
<span class="p">{</span>
  <span class="n">function</span> <span class="nf">Initialize</span><span class="p">(</span><span class="n">init</span> <span class="p">:</span> <span class="n">CogInitializer</span><span class="p">)</span>
  <span class="p">{</span>

  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li>In the SoakResponse script<ul>
<li>Make the following set of additions to the code:</li>
</ul>
</li>
</ul>
<div class="highlight-csharp"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SoakResponse</span> <span class="p">:</span> <span class="n">ZilchComponent</span>
<span class="p">{</span>
<span class="hll"><span class="na">  [Dependency]</span>
</span><span class="hll">  <span class="kt">var</span> <span class="n">Transform</span> <span class="p">:</span> <span class="n">Transform</span><span class="p">;</span>
</span>
  <span class="p">.</span>
  <span class="p">.</span>
  <span class="p">.</span>
</pre></div>
</div>
<p>We give this component a Transform dependency so that we can use
<code class="docutils literal"><span class="pre">this.Transform</span></code> as a shortcut.</p>
<div class="nextblock container">
Next:</div>
<div class="highlight-csharp"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SoakResponse</span> <span class="p">:</span> <span class="n">ZilchComponent</span>
<span class="p">{</span>
<span class="na">  [Dependency]</span>
  <span class="kt">var</span> <span class="n">Transform</span> <span class="p">:</span> <span class="n">Transform</span><span class="p">;</span>


<span class="hll"><span class="na">  [Property]</span>
</span><span class="hll">  <span class="kt">var</span> <span class="n">WaterLayerArchetype</span> <span class="p">:</span> <span class="n">Archetype</span> <span class="p">=</span> <span class="n">Archetype</span><span class="p">.</span><span class="n">WaterLayer</span><span class="p">;</span>
</span>
  <span class="p">.</span>
  <span class="p">.</span>
  <span class="p">.</span>
</pre></div>
</div>
<p>Here we specify the archetype we&#8217;re going to spawn for our layers of water we&#8217;ll
be spawning on the target.</p>
<div class="nextblock container">
Next:</div>
<div class="highlight-csharp"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SoakResponse</span> <span class="p">:</span> <span class="n">ZilchComponent</span>
<span class="p">{</span>
<span class="na">  [Dependency]</span>
  <span class="kt">var</span> <span class="n">Transform</span> <span class="p">:</span> <span class="n">Transform</span><span class="p">;</span>


<span class="na">  [Property]</span>
  <span class="kt">var</span> <span class="n">WaterLayerArchetype</span> <span class="p">:</span> <span class="n">Archetype</span> <span class="p">=</span> <span class="n">Archetype</span><span class="p">.</span><span class="n">WaterLayer</span><span class="p">;</span>

<span class="hll">  <span class="kt">var</span> <span class="n">RNG</span> <span class="p">:</span> <span class="n">Random</span> <span class="p">=</span> <span class="n">Random</span><span class="p">();</span>
</span><span class="hll">  <span class="kt">var</span> <span class="n">MaxRandomDistance</span> <span class="p">:</span> <span class="n">Real</span> <span class="p">=</span> <span class="m">0.5</span><span class="p">;</span>
</span>
  <span class="p">.</span>
  <span class="p">.</span>
  <span class="p">.</span>
</pre></div>
</div>
<p>We are going to use a <code class="xref cpp cpp-type docutils literal"><span class="pre">random</span> <span class="pre">number</span> <span class="pre">generator</span></code> to allow us to
randomize the placement of the water layer just a little bit. The
<code class="docutils literal"><span class="pre">MaxRandomDistance</span></code> member variable determines how far from the center of the
target the water layer can potentially be placed.</p>
<div class="nextblock container">
Next:</div>
<div class="highlight-csharp"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SoakResponse</span> <span class="p">:</span> <span class="n">ZilchComponent</span>
<span class="p">{</span>
<span class="na">  [Dependency]</span>
  <span class="kt">var</span> <span class="n">Transform</span> <span class="p">:</span> <span class="n">Transform</span><span class="p">;</span>


<span class="na">  [Property]</span>
  <span class="kt">var</span> <span class="n">WaterLayerArchetype</span> <span class="p">:</span> <span class="n">Archetype</span> <span class="p">=</span> <span class="n">Archetype</span><span class="p">.</span><span class="n">WaterLayer</span><span class="p">;</span>

  <span class="kt">var</span> <span class="n">RNG</span> <span class="p">:</span> <span class="n">Random</span> <span class="p">=</span> <span class="n">Random</span><span class="p">();</span>
  <span class="kt">var</span> <span class="n">MaxRandomDistance</span> <span class="p">:</span> <span class="n">Real</span> <span class="p">=</span> <span class="m">0.5</span><span class="p">;</span>

<span class="hll">  <span class="kt">var</span> <span class="n">FinalOffset</span> <span class="p">:</span> <span class="n">Real3</span> <span class="p">=</span> <span class="n">Real3</span><span class="p">(</span><span class="m">0.0</span><span class="p">,</span> <span class="m">0.0</span><span class="p">,</span> <span class="m">1.0</span><span class="p">);</span>
</span>
  <span class="p">.</span>
  <span class="p">.</span>
  <span class="p">.</span>
</pre></div>
</div>
<p>When we spawn our water layers, we want to place them at nearly the same
location as the target itself. To avoid Z-fighting between their sprites and the
target&#8217;s sprite, we&#8217;ll give them a bit of a boost in the Z direction by adding
on the <code class="docutils literal"><span class="pre">FinalOffset</span></code> member variable to their generated position.</p>
<div class="nextblock container">
Next:</div>
<div class="highlight-csharp"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SoakResponse</span> <span class="p">:</span> <span class="n">ZilchComponent</span>
<span class="p">{</span>
<span class="na">  [Dependency]</span>
  <span class="kt">var</span> <span class="n">Transform</span> <span class="p">:</span> <span class="n">Transform</span><span class="p">;</span>


<span class="na">  [Property]</span>
  <span class="kt">var</span> <span class="n">WaterLayerArchetype</span> <span class="p">:</span> <span class="n">Archetype</span> <span class="p">=</span> <span class="n">Archetype</span><span class="p">.</span><span class="n">WaterLayer</span><span class="p">;</span>

  <span class="kt">var</span> <span class="n">RNG</span> <span class="p">:</span> <span class="n">Random</span> <span class="p">=</span> <span class="n">Random</span><span class="p">();</span>
  <span class="kt">var</span> <span class="n">MaxRandomDistance</span> <span class="p">:</span> <span class="n">Real</span> <span class="p">=</span> <span class="m">0.5</span><span class="p">;</span>

  <span class="kt">var</span> <span class="n">FinalOffset</span> <span class="p">:</span> <span class="n">Real3</span> <span class="p">=</span> <span class="n">Real3</span><span class="p">(</span><span class="m">0.0</span><span class="p">,</span> <span class="m">0.0</span><span class="p">,</span> <span class="m">1.0</span><span class="p">);</span>


  <span class="n">function</span> <span class="nf">Initialize</span><span class="p">(</span><span class="n">init</span> <span class="p">:</span> <span class="n">CogInitializer</span><span class="p">)</span>
  <span class="p">{</span>
<span class="hll">    <span class="n">Zero</span><span class="p">.</span><span class="n">Connect</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">Owner</span><span class="p">,</span> <span class="n">Events</span><span class="p">.</span><span class="n">Soak</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="n">OnSoak</span><span class="p">);</span>
</span>  <span class="p">}</span>


<span class="hll">  <span class="n">function</span> <span class="nf">OnSoak</span><span class="p">(</span><span class="k">event</span> <span class="p">:</span> <span class="n">ZilchEvent</span><span class="p">)</span>
</span><span class="hll">  <span class="p">{</span>
</span><span class="hll">
</span><span class="hll">  <span class="p">}</span>
</span><span class="p">}</span>
</pre></div>
</div>
<p>We make a <code class="docutils literal"><span class="pre">Zero.Connect</span></code> event connection so that when the <strong>Soak</strong> event is
dispatched to this target, this component&#8217;s <code class="docutils literal"><span class="pre">OnSoak</span></code> function is called.</p>
<p>In the <code class="docutils literal"><span class="pre">OnSoak</span></code> function, we&#8217;re going to determine where to spawn the water
layer by pointing in a random direction, and then choosing a random distance,
and placing the water layer that distance from the center of the target in the
chosen direction.</p>
<p>The <strong>Random</strong> class includes some useful functions for generating vectors,
including creating random <em>unit vectors</em>, or vectors whose length is exactly 1
&#8212; perfect for use as a <strong>direction vector</strong>.</p>
<ul class="simple">
<li>In the SoakResponse script<ul>
<li>Make the following set of additions to the <code class="docutils literal"><span class="pre">OnSoak</span></code> function:</li>
</ul>
</li>
</ul>
<div class="highlight-csharp"><div class="highlight"><pre><span></span><span class="n">function</span> <span class="nf">OnSoak</span><span class="p">(</span><span class="k">event</span> <span class="p">:</span> <span class="n">ZilchEvent</span><span class="p">)</span>
<span class="p">{</span>
<span class="hll">  <span class="c1">// First, we determine what direction the water will placed in</span>
</span><span class="hll">  <span class="kt">var</span> <span class="n">random2DDirection</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">RNG</span><span class="p">.</span><span class="n">UnitReal2</span><span class="p">();</span>
</span><span class="hll">  <span class="kt">var</span> <span class="n">randomOffsetDirection</span> <span class="p">=</span> <span class="n">Real3</span><span class="p">(</span><span class="n">random2DDirection</span><span class="p">,</span> <span class="m">0.0</span><span class="p">);</span>
</span><span class="p">}</span>
</pre></div>
</div>
<p>First we randomly choose our direction. Because this is a 2D game and we don&#8217;t
want to include the Z direction in our random consideration, we&#8217;ll use the
<code class="docutils literal"><span class="pre">Random.UnitReal2</span></code> function, which, as its name implies, creates a unit
<code class="xref cpp cpp-type docutils literal"><span class="pre">Real2</span></code> vector. Since we&#8217;re going to use this vector to place an
object in the world, we have to convert it into a <strong>Real3</strong> before we can do
anything with it.</p>
<div class="nextblock container">
Next:</div>
<div class="highlight-csharp"><div class="highlight"><pre><span></span><span class="n">function</span> <span class="nf">OnSoak</span><span class="p">(</span><span class="k">event</span> <span class="p">:</span> <span class="n">ZilchEvent</span><span class="p">)</span>
<span class="p">{</span>
  <span class="c1">// First, we determine what direction the water will placed in</span>
  <span class="kt">var</span> <span class="n">random2DDirection</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">RNG</span><span class="p">.</span><span class="n">UnitReal2</span><span class="p">();</span>
  <span class="kt">var</span> <span class="n">randomOffsetDirection</span> <span class="p">=</span> <span class="n">Real3</span><span class="p">(</span><span class="n">random2DDirection</span><span class="p">,</span> <span class="m">0.0</span><span class="p">);</span>

<span class="hll">  <span class="c1">// Next, we determine how far in that direction it will be placed</span>
</span><span class="hll">  <span class="kt">var</span> <span class="n">randomOffsetDistance</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">RNG</span><span class="p">.</span><span class="n">Range</span><span class="p">(</span><span class="m">0.0</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="n">MaxRandomDistance</span><span class="p">);</span>
</span><span class="p">}</span>
</pre></div>
</div>
<p>Now we need to determine our random distance. The <code class="docutils literal"><span class="pre">Random.Range</span></code> function
allows us to specify lower and upper bounds and returns a <strong>Real</strong> within the
given range. We want a random distance between 0 and our <code class="docutils literal"><span class="pre">MaxRandomDistance</span></code>
member variable.</p>
<div class="nextblock container">
Next:</div>
<div class="highlight-csharp"><div class="highlight"><pre><span></span><span class="n">function</span> <span class="nf">OnSoak</span><span class="p">(</span><span class="k">event</span> <span class="p">:</span> <span class="n">ZilchEvent</span><span class="p">)</span>
<span class="p">{</span>
  <span class="c1">// First, we determine what direction the water will placed in</span>
  <span class="kt">var</span> <span class="n">random2DDirection</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">RNG</span><span class="p">.</span><span class="n">UnitReal2</span><span class="p">();</span>
  <span class="kt">var</span> <span class="n">randomOffsetDirection</span> <span class="p">=</span> <span class="n">Real3</span><span class="p">(</span><span class="n">random2DDirection</span><span class="p">,</span> <span class="m">0.0</span><span class="p">);</span>

  <span class="c1">// Next, we determine how far in that direction it will be placed</span>
  <span class="kt">var</span> <span class="n">randomOffsetDistance</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">RNG</span><span class="p">.</span><span class="n">Range</span><span class="p">(</span><span class="m">0.0</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="n">MaxRandomDistance</span><span class="p">);</span>

<span class="hll">  <span class="c1">// The offset for placing the water layer is</span>
</span><span class="hll">  <span class="c1">// the random distance times the random direction</span>
</span><span class="hll">  <span class="kt">var</span> <span class="n">randomOffset</span> <span class="p">=</span> <span class="n">randomOffsetDistance</span> <span class="p">*</span> <span class="n">randomOffsetDirection</span><span class="p">;</span>
</span><span class="p">}</span>
</pre></div>
</div>
<p>Next, we scale our random direction by our random distance to produce our
<strong>random offset</strong>.</p>
<div class="nextblock container">
Next:</div>
<div class="highlight-csharp"><div class="highlight"><pre><span></span><span class="n">function</span> <span class="nf">OnSoak</span><span class="p">(</span><span class="k">event</span> <span class="p">:</span> <span class="n">ZilchEvent</span><span class="p">)</span>
<span class="p">{</span>
  <span class="c1">// First, we determine what direction the water will placed in</span>
  <span class="kt">var</span> <span class="n">random2DDirection</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">RNG</span><span class="p">.</span><span class="n">UnitReal2</span><span class="p">();</span>
  <span class="kt">var</span> <span class="n">randomOffsetDirection</span> <span class="p">=</span> <span class="n">Real3</span><span class="p">(</span><span class="n">random2DDirection</span><span class="p">,</span> <span class="m">0.0</span><span class="p">);</span>

  <span class="c1">// Next, we determine how far in that direction it will be placed</span>
  <span class="kt">var</span> <span class="n">randomOffsetDistance</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">RNG</span><span class="p">.</span><span class="n">Range</span><span class="p">(</span><span class="m">0.0</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="n">MaxRandomDistance</span><span class="p">);</span>

  <span class="c1">// The offset for placing the water layer is</span>
  <span class="c1">// the random distance times the random direction</span>
  <span class="kt">var</span> <span class="n">randomOffset</span> <span class="p">=</span> <span class="n">randomOffsetDistance</span> <span class="p">*</span> <span class="n">randomOffsetDirection</span><span class="p">;</span>

<span class="hll">  <span class="c1">// The final position for the water layer is this target&#39;s location plus</span>
</span><span class="hll">  <span class="c1">// the random offset we just calculated, plus the final offset property</span>
</span><span class="hll">  <span class="kt">var</span> <span class="n">waterLayerPosition</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">Transform</span><span class="p">.</span><span class="n">WorldTranslation</span> <span class="p">+</span> <span class="n">randomOffset</span> <span class="p">+</span> <span class="k">this</span><span class="p">.</span><span class="n">FinalOffset</span><span class="p">;</span>
</span><span class="p">}</span>
</pre></div>
</div>
<p>We finally have everything we need to decide where the water layer should be
spawned. The water layer&#8217;s final position is the position of the target, plus
the random offset we just calculated, plus the <code class="docutils literal"><span class="pre">FinalOffset</span></code> property (to
avoid Z fighting).</p>
<div class="nextblock container">
Finally:</div>
<div class="highlight-csharp"><div class="highlight"><pre><span></span><span class="n">function</span> <span class="nf">OnSoak</span><span class="p">(</span><span class="k">event</span> <span class="p">:</span> <span class="n">ZilchEvent</span><span class="p">)</span>
<span class="p">{</span>
  <span class="c1">// First, we determine what direction the water will placed in</span>
  <span class="kt">var</span> <span class="n">random2DDirection</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">RNG</span><span class="p">.</span><span class="n">UnitReal2</span><span class="p">();</span>
  <span class="kt">var</span> <span class="n">randomOffsetDirection</span> <span class="p">=</span> <span class="n">Real3</span><span class="p">(</span><span class="n">random2DDirection</span><span class="p">,</span> <span class="m">0.0</span><span class="p">);</span>

  <span class="c1">// Next, we determine how far in that direction it will be placed</span>
  <span class="kt">var</span> <span class="n">randomOffsetDistance</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">RNG</span><span class="p">.</span><span class="n">Range</span><span class="p">(</span><span class="m">0.0</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="n">MaxRandomDistance</span><span class="p">);</span>

  <span class="c1">// The offset for placing the water layer is</span>
  <span class="c1">// the random distance times the random direction</span>
  <span class="kt">var</span> <span class="n">randomOffset</span> <span class="p">=</span> <span class="n">randomOffsetDistance</span> <span class="p">*</span> <span class="n">randomOffsetDirection</span><span class="p">;</span>

  <span class="c1">// The final position for the water layer is this target&#39;s location plus</span>
  <span class="c1">// the random offset we just calculated, plus the final offset property</span>
  <span class="kt">var</span> <span class="n">waterLayerPosition</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">Transform</span><span class="p">.</span><span class="n">WorldTranslation</span> <span class="p">+</span> <span class="n">randomOffset</span> <span class="p">+</span> <span class="k">this</span><span class="p">.</span><span class="n">FinalOffset</span><span class="p">;</span>

<span class="hll">  <span class="kt">var</span> <span class="n">waterLayer</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">Space</span><span class="p">.</span><span class="n">CreateAtPosition</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">WaterLayerArchetype</span><span class="p">,</span> <span class="n">waterLayerPosition</span><span class="p">);</span>
</span><span class="p">}</span>
</pre></div>
</div>
<p>Finally, we make the water layer cog at the calculated position.</p>
<p>Let&#8217;s add this new component to the target.</p>
<ul class="simple">
<li><a class="reference internal" href="SelectObject.html#selectobject"><span>Select the Target object</span></a></li>
<li>In the Properties Window<ul>
<li><a class="reference internal" href="AddComponent.html#addcomponent"><span>Add a SoakResponse component</span></a></li>
<li><code class="docutils literal"><span class="pre">Left-click</span></code> the green <strong>Upload to Archetype</strong> button</li>
</ul>
</li>
<li><a class="reference internal" href="SavingProject.html#savingproject"><span>Save the project</span></a> and <a class="reference internal" href="RunTheGame.html#runthegame"><span>run the game</span></a></li>
</ul>
<p><img alt="WaterSoakingTarget" src="../../_images/WaterSoakingTarget1.gif" /></p>
<p>We can now soak the target with water.</p>
<ul class="simple">
<li><a class="reference internal" href="StopGame.html#stopgame"><span>Stop the Game</span></a></li>
</ul>
<p>Let&#8217;s make more targets to shoot water at.</p>
<ul>
<li><p class="first"><a class="reference internal" href="SelectObject.html#selectobject"><span>Select the Target object</span></a></p>
</li>
<li><p class="first">Select the <strong>TranslateTool</strong></p>
</li>
<li><p class="first">While holding the <code class="docutils literal"><span class="pre">Ctrl</span></code> key, <code class="docutils literal"><span class="pre">Left-Drag</span></code> the manipulators of the
TranslateGizmo to <strong>duplicate</strong> the target</p>
<p><img alt="DragDuplicate" src="../../_images/DragDuplicate1.gif" /></p>
</li>
<li><p class="first">Make many copies of the target object and place them around the level</p>
<p><img alt="ManyTargets" src="../../_images/ManyTargets1.png" /></p>
</li>
</ul>
<p>Let&#8217;s try it out again.</p>
<ul class="simple">
<li><a class="reference internal" href="SavingProject.html#savingproject"><span>Save the project</span></a> and <a class="reference internal" href="RunTheGame.html#runthegame"><span>run the game</span></a></li>
</ul>
<p>Now we have plenty of targets to hit. But we can still make this even more
interesting.</p>
<ul class="simple">
<li><a class="reference internal" href="StopGame.html#stopgame"><span>Stop the Game</span></a></li>
</ul>
</div>
<div class="section" id="firing-cone">
<h2>Firing Cone</h2>
<p>So far, the water stream has fired in a straight line from the water cannon. It
might be more effective at getting the targets wet if it covered a wider area.
We can make this happen with some adjustments to the WaterCannon component, and
a little more understanding of the <strong>sine</strong> function.</p>
<p>Consider again the output of the sine function as its input angle continuously
increases:</p>
<p><img alt="CosineAndSine" src="../../_images/CosineAndSine1.gif" /></p>
<p>As the angle goes up and up, and the vector goes around and around the circle,
the <em>sine of the angle goes back and forth between 1 and -1</em>. This means that,
no matter what we put into the sine function, we will never get an output that
is greater than 1 or less than -1. We can use this fact to make the water stream
wave back and forth in a cone.</p>
<ul class="simple">
<li>In the WaterCannon script<ul>
<li>Make the following set of additions to the code:</li>
</ul>
</li>
</ul>
<div class="highlight-csharp"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">WaterCannon</span> <span class="p">:</span> <span class="n">ZilchComponent</span>
<span class="p">{</span>
<span class="na">  [Dependency]</span>
  <span class="kt">var</span> <span class="n">Transform</span> <span class="p">:</span> <span class="n">Transform</span><span class="p">;</span>


<span class="na">  [Property]</span>
  <span class="kt">var</span> <span class="n">WaterArchetype</span> <span class="p">:</span> <span class="n">Archetype</span> <span class="p">=</span> <span class="n">Archetype</span><span class="p">.</span><span class="n">Water</span><span class="p">;</span>
<span class="na">  [Property]</span>
  <span class="kt">var</span> <span class="n">WaterSpeed</span> <span class="p">:</span> <span class="n">Real</span> <span class="p">=</span> <span class="m">20.0</span><span class="p">;</span>
<span class="hll"><span class="na">  [Property]</span>
</span><span class="hll">  <span class="kt">var</span> <span class="n">ConeHalfAngle</span> <span class="p">:</span> <span class="n">Real</span> <span class="p">=</span> <span class="m">5.0</span><span class="p">;</span>
</span><span class="na">  [Property]</span>
  <span class="kt">var</span> <span class="n">Cannon</span> <span class="p">:</span> <span class="n">CogPath</span><span class="p">;</span>

  <span class="p">.</span>
  <span class="p">.</span>
  <span class="p">.</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">ConeHalfAngle</span></code> property defines half the measure of the firing angle.</p>
<ul class="simple">
<li>Why are we defining the <em>half-angle</em> instead of the full firing angle?
We&#8217;ll cover that soon.</li>
<li>The <code class="docutils literal"><span class="pre">ConeHalfAngle</span></code> property will take an angle in <strong>degrees</strong>, not
radians, because we&#8217;re going to be manipulating its value directly, and
it&#8217;s easier to work with degrees and then convert to radians later.</li>
</ul>
<div class="nextblock container">
Next:</div>
<div class="highlight-csharp"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">WaterCannon</span> <span class="p">:</span> <span class="n">ZilchComponent</span>
<span class="p">{</span>
<span class="na">  [Dependency]</span>
  <span class="kt">var</span> <span class="n">Transform</span> <span class="p">:</span> <span class="n">Transform</span><span class="p">;</span>


<span class="na">  [Property]</span>
  <span class="kt">var</span> <span class="n">WaterArchetype</span> <span class="p">:</span> <span class="n">Archetype</span> <span class="p">=</span> <span class="n">Archetype</span><span class="p">.</span><span class="n">Water</span><span class="p">;</span>
<span class="na">  [Property]</span>
  <span class="kt">var</span> <span class="n">WaterSpeed</span> <span class="p">:</span> <span class="n">Real</span> <span class="p">=</span> <span class="m">20.0</span><span class="p">;</span>
<span class="na">  [Property]</span>
  <span class="kt">var</span> <span class="n">ConeHalfAngle</span> <span class="p">:</span> <span class="n">Real</span> <span class="p">=</span> <span class="m">5.0</span><span class="p">;</span>
<span class="hll"><span class="na">  [Property]</span>
</span><span class="hll">  <span class="kt">var</span> <span class="n">WavePeriod</span> <span class="p">:</span> <span class="n">Real</span> <span class="p">=</span> <span class="m">0.5</span><span class="p">;</span>
</span><span class="na">  [Property]</span>
  <span class="kt">var</span> <span class="n">Cannon</span> <span class="p">:</span> <span class="n">CogPath</span><span class="p">;</span>

  <span class="p">.</span>
  <span class="p">.</span>
  <span class="p">.</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">WavePeriod</span></code> property defines how long it will take for the wave to get
back to the angle where it started.</p>
<ul class="simple">
<li>The <code class="docutils literal"><span class="pre">WavePeriod</span></code> property is a time in <strong>seconds</strong>.</li>
</ul>
<div class="nextblock container">
Next:</div>
<div class="highlight-csharp"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">WaterCannon</span> <span class="p">:</span> <span class="n">ZilchComponent</span>
<span class="p">{</span>
<span class="na">  [Dependency]</span>
  <span class="kt">var</span> <span class="n">Transform</span> <span class="p">:</span> <span class="n">Transform</span><span class="p">;</span>


<span class="na">  [Property]</span>
  <span class="kt">var</span> <span class="n">WaterArchetype</span> <span class="p">:</span> <span class="n">Archetype</span> <span class="p">=</span> <span class="n">Archetype</span><span class="p">.</span><span class="n">Water</span><span class="p">;</span>
<span class="na">  [Property]</span>
  <span class="kt">var</span> <span class="n">WaterSpeed</span> <span class="p">:</span> <span class="n">Real</span> <span class="p">=</span> <span class="m">20.0</span><span class="p">;</span>
<span class="na">  [Property]</span>
  <span class="kt">var</span> <span class="n">ConeHalfAngle</span> <span class="p">:</span> <span class="n">Real</span> <span class="p">=</span> <span class="m">5.0</span><span class="p">;</span>
<span class="na">  [Property]</span>
  <span class="kt">var</span> <span class="n">WavePeriod</span> <span class="p">:</span> <span class="n">Real</span> <span class="p">=</span> <span class="m">0.5</span><span class="p">;</span>
<span class="na">  [Property]</span>
  <span class="kt">var</span> <span class="n">Cannon</span> <span class="p">:</span> <span class="n">CogPath</span><span class="p">;</span>

<span class="hll">  <span class="kt">var</span> <span class="n">Time</span> <span class="p">:</span> <span class="n">Real</span> <span class="p">=</span> <span class="m">0.0</span><span class="p">;</span>
</span>
  <span class="p">.</span>
  <span class="p">.</span>
  <span class="p">.</span>
</pre></div>
</div>
<p>We have a new member variable: <code class="docutils literal"><span class="pre">Time</span></code>, which will keep track of time spent
firing water. Note how, in the <code class="docutils literal"><span class="pre">OnLogicUpdate</span></code> function, we increment the
<code class="docutils literal"><span class="pre">Time</span></code> variable by <code class="docutils literal"><span class="pre">event.Dt</span></code>.</p>
<ul class="simple">
<li>We&#8217;re going to use elapsed time as a way of providing an ever-changing angle
to the <strong>sine</strong> function we&#8217;ll use to drive our wave&#8217;s oscillation.</li>
</ul>
<div class="nextblock container">
Next:</div>
<div class="highlight-csharp"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">WaterCannon</span> <span class="p">:</span> <span class="n">ZilchComponent</span>
<span class="p">{</span>
<span class="na">  [Dependency]</span>
  <span class="kt">var</span> <span class="n">Transform</span> <span class="p">:</span> <span class="n">Transform</span><span class="p">;</span>


<span class="na">  [Property]</span>
  <span class="kt">var</span> <span class="n">WaterArchetype</span> <span class="p">:</span> <span class="n">Archetype</span> <span class="p">=</span> <span class="n">Archetype</span><span class="p">.</span><span class="n">Water</span><span class="p">;</span>
<span class="na">  [Property]</span>
  <span class="kt">var</span> <span class="n">WaterSpeed</span> <span class="p">:</span> <span class="n">Real</span> <span class="p">=</span> <span class="m">20.0</span><span class="p">;</span>
<span class="na">  [Property]</span>
  <span class="kt">var</span> <span class="n">ConeHalfAngle</span> <span class="p">:</span> <span class="n">Real</span> <span class="p">=</span> <span class="m">5.0</span><span class="p">;</span>
<span class="na">  [Property]</span>
  <span class="kt">var</span> <span class="n">WavePeriod</span> <span class="p">:</span> <span class="n">Real</span> <span class="p">=</span> <span class="m">0.5</span><span class="p">;</span>
<span class="na">  [Property]</span>
  <span class="kt">var</span> <span class="n">Cannon</span> <span class="p">:</span> <span class="n">CogPath</span><span class="p">;</span>

  <span class="kt">var</span> <span class="n">Time</span> <span class="p">:</span> <span class="n">Real</span> <span class="p">=</span> <span class="m">0.0</span><span class="p">;</span>


  <span class="n">function</span> <span class="nf">Initialize</span><span class="p">(</span><span class="n">init</span> <span class="p">:</span> <span class="n">CogInitializer</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">Zero</span><span class="p">.</span><span class="n">Connect</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">Space</span><span class="p">,</span> <span class="n">Events</span><span class="p">.</span><span class="n">LogicUpdate</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="n">OnLogicUpdate</span><span class="p">);</span>
  <span class="p">}</span>


  <span class="n">function</span> <span class="nf">OnLogicUpdate</span><span class="p">(</span><span class="k">event</span> <span class="p">:</span> <span class="n">UpdateEvent</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="n">Zero</span><span class="p">.</span><span class="n">Mouse</span><span class="p">.</span><span class="n">IsButtonDown</span><span class="p">(</span><span class="n">MouseButtons</span><span class="p">.</span><span class="n">Left</span><span class="p">))</span>
    <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="n">Fire</span><span class="p">();</span>

<span class="hll">      <span class="k">this</span><span class="p">.</span><span class="n">Time</span> <span class="p">+=</span> <span class="k">event</span><span class="p">.</span><span class="n">Dt</span><span class="p">;</span>
</span>    <span class="p">}</span>
  <span class="p">}</span>

  <span class="p">.</span>
  <span class="p">.</span>
  <span class="p">.</span>
</pre></div>
</div>
<p>Here, we add the elapsed time each frame onto our <code class="docutils literal"><span class="pre">Time</span></code> variable.</p>
<p>Next, we&#8217;ll modify our firing function to use a <em>sine-based oscillation factor</em>.</p>
<ul class="simple">
<li>In the WaterCannon script<ul>
<li>Make the following set of additions to the <code class="docutils literal"><span class="pre">Fire</span></code> function:</li>
</ul>
</li>
</ul>
<div class="highlight-csharp"><div class="highlight"><pre><span></span><span class="n">function</span> <span class="nf">Fire</span><span class="p">()</span>
<span class="p">{</span>
  <span class="kt">var</span> <span class="n">waterPosition</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">Cannon</span><span class="p">.</span><span class="n">Cog</span><span class="p">.</span><span class="n">Transform</span><span class="p">.</span><span class="n">WorldTranslation</span><span class="p">;</span>
  <span class="n">waterPosition</span><span class="p">.</span><span class="n">Z</span> <span class="p">=</span> <span class="m">0.0</span><span class="p">;</span>
  <span class="kt">var</span> <span class="n">water</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">Space</span><span class="p">.</span><span class="n">CreateAtPosition</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">WaterArchetype</span><span class="p">,</span> <span class="n">waterPosition</span><span class="p">);</span>

<span class="hll">  <span class="kt">var</span> <span class="n">facingAngle</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">Transform</span><span class="p">.</span><span class="n">EulerAngles</span><span class="p">.</span><span class="n">Z</span><span class="p">;</span>
</span>
  <span class="c1">// The firing angle is equal to the rotation angle about the Z axis</span>
  <span class="kt">var</span> <span class="n">firingAngle</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">Transform</span><span class="p">.</span><span class="n">EulerAngles</span><span class="p">.</span><span class="n">Z</span><span class="p">;</span>

  <span class="c1">// The length of a direction vector is 1, so we do not need to multiply</span>
  <span class="c1">// the cosine and sine of the angle by anything to get the x and y parts</span>
  <span class="kt">var</span> <span class="n">xPart</span> <span class="p">=</span> <span class="n">Math</span><span class="p">.</span><span class="n">Cos</span><span class="p">(</span><span class="n">firingAngle</span><span class="p">);</span>
  <span class="kt">var</span> <span class="n">yPart</span> <span class="p">=</span> <span class="n">Math</span><span class="p">.</span><span class="n">Sin</span><span class="p">(</span><span class="n">firingAngle</span><span class="p">);</span>
  <span class="c1">// This vector does not extend at all into the Z direction</span>
  <span class="kt">var</span> <span class="n">zPart</span> <span class="p">=</span> <span class="m">0.0</span><span class="p">;</span>

  <span class="kt">var</span> <span class="n">firingDirection</span> <span class="p">=</span> <span class="n">Real3</span><span class="p">(</span><span class="n">xPart</span><span class="p">,</span> <span class="n">yPart</span><span class="p">,</span> <span class="n">zPart</span><span class="p">);</span>

  <span class="n">water</span><span class="p">.</span><span class="n">RigidBody</span><span class="p">.</span><span class="n">Velocity</span> <span class="p">=</span> <span class="n">firingDirection</span> <span class="p">*</span> <span class="k">this</span><span class="p">.</span><span class="n">WaterSpeed</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Before, we were taking the player&#8217;s Z-rotation and using that as the
<em>firingAngle</em>. We&#8217;ve left that line of code in for now, so that it will still
compile properly, but now we&#8217;ve added another name for the Z-rotation: the
<code class="docutils literal"><span class="pre">facingAngle</span></code>. This is because the actual firing angle is going to be a more
complex combination of parts, rather than being just a single rotation.</p>
<div class="nextblock container">
Next:</div>
<div class="highlight-csharp"><div class="highlight"><pre><span></span><span class="n">function</span> <span class="nf">Fire</span><span class="p">()</span>
<span class="p">{</span>
  <span class="kt">var</span> <span class="n">waterPosition</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">Cannon</span><span class="p">.</span><span class="n">Cog</span><span class="p">.</span><span class="n">Transform</span><span class="p">.</span><span class="n">WorldTranslation</span><span class="p">;</span>
  <span class="n">waterPosition</span><span class="p">.</span><span class="n">Z</span> <span class="p">=</span> <span class="m">0.0</span><span class="p">;</span>
  <span class="kt">var</span> <span class="n">water</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">Space</span><span class="p">.</span><span class="n">CreateAtPosition</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">WaterArchetype</span><span class="p">,</span> <span class="n">waterPosition</span><span class="p">);</span>

  <span class="kt">var</span> <span class="n">facingAngle</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">Transform</span><span class="p">.</span><span class="n">EulerAngles</span><span class="p">.</span><span class="n">Z</span><span class="p">;</span>

<span class="hll">  <span class="c1">// Here is our sine-based oscillation factor</span>
</span><span class="hll">  <span class="kt">var</span> <span class="n">oscillationFactor</span> <span class="p">=</span> <span class="n">Math</span><span class="p">.</span><span class="n">Sin</span><span class="p">(</span><span class="n">Math</span><span class="p">.</span><span class="n">ToRadians</span><span class="p">(</span><span class="m">360.0</span> <span class="p">*</span> <span class="k">this</span><span class="p">.</span><span class="n">Time</span> <span class="p">/</span> <span class="k">this</span><span class="p">.</span><span class="n">WavePeriod</span><span class="p">));</span>
</span>
  <span class="c1">// The firing angle is equal to the rotation angle about the Z axis</span>
  <span class="kt">var</span> <span class="n">firingAngle</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">Transform</span><span class="p">.</span><span class="n">EulerAngles</span><span class="p">.</span><span class="n">Z</span><span class="p">;</span>

  <span class="c1">// The length of a direction vector is 1, so we do not need to multiply</span>
  <span class="c1">// the cosine and sine of the angle by anything to get the x and y parts</span>
  <span class="kt">var</span> <span class="n">xPart</span> <span class="p">=</span> <span class="n">Math</span><span class="p">.</span><span class="n">Cos</span><span class="p">(</span><span class="n">firingAngle</span><span class="p">);</span>
  <span class="kt">var</span> <span class="n">yPart</span> <span class="p">=</span> <span class="n">Math</span><span class="p">.</span><span class="n">Sin</span><span class="p">(</span><span class="n">firingAngle</span><span class="p">);</span>
  <span class="c1">// This vector does not extend at all into the Z direction</span>
  <span class="kt">var</span> <span class="n">zPart</span> <span class="p">=</span> <span class="m">0.0</span><span class="p">;</span>

  <span class="kt">var</span> <span class="n">firingDirection</span> <span class="p">=</span> <span class="n">Real3</span><span class="p">(</span><span class="n">xPart</span><span class="p">,</span> <span class="n">yPart</span><span class="p">,</span> <span class="n">zPart</span><span class="p">);</span>

  <span class="n">water</span><span class="p">.</span><span class="n">RigidBody</span><span class="p">.</span><span class="n">Velocity</span> <span class="p">=</span> <span class="n">firingDirection</span> <span class="p">*</span> <span class="k">this</span><span class="p">.</span><span class="n">WaterSpeed</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">oscillationFactor</span></code> will drive our water cannon&#8217;s wave motion.</p>
<ul class="simple">
<li>Note how the outermost operation done on the right side of the equals sign
of the <code class="docutils literal"><span class="pre">oscillationFactor</span></code> is the <code class="docutils literal"><span class="pre">Math.Sin</span></code> function &#8212; this
guarantees that the <code class="docutils literal"><span class="pre">oscillationFactor</span></code> will be between 1 and -1.</li>
</ul>
<div class="nextblock container">
Next:</div>
<div class="highlight-csharp"><div class="highlight"><pre><span></span><span class="n">function</span> <span class="nf">Fire</span><span class="p">()</span>
<span class="p">{</span>
  <span class="kt">var</span> <span class="n">waterPosition</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">Cannon</span><span class="p">.</span><span class="n">Cog</span><span class="p">.</span><span class="n">Transform</span><span class="p">.</span><span class="n">WorldTranslation</span><span class="p">;</span>
  <span class="n">waterPosition</span><span class="p">.</span><span class="n">Z</span> <span class="p">=</span> <span class="m">0.0</span><span class="p">;</span>
  <span class="kt">var</span> <span class="n">water</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">Space</span><span class="p">.</span><span class="n">CreateAtPosition</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">WaterArchetype</span><span class="p">,</span> <span class="n">waterPosition</span><span class="p">);</span>

  <span class="kt">var</span> <span class="n">facingAngle</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">Transform</span><span class="p">.</span><span class="n">EulerAngles</span><span class="p">.</span><span class="n">Z</span><span class="p">;</span>

  <span class="c1">// Here is our sine-based oscillation factor</span>
  <span class="kt">var</span> <span class="n">oscillationFactor</span> <span class="p">=</span> <span class="n">Math</span><span class="p">.</span><span class="n">Sin</span><span class="p">(</span><span class="n">Math</span><span class="p">.</span><span class="n">ToRadians</span><span class="p">(</span><span class="m">360.0</span> <span class="p">*</span> <span class="k">this</span><span class="p">.</span><span class="n">Time</span> <span class="p">/</span> <span class="k">this</span><span class="p">.</span><span class="n">WavePeriod</span><span class="p">));</span>

<span class="hll">  <span class="c1">// The wave angle oscillates back and forth between the positive and negative ConeHalfAngle</span>
</span><span class="hll">  <span class="c1">//   -- The wave angle is in radians</span>
</span><span class="hll">  <span class="kt">var</span> <span class="n">waveAngle</span> <span class="p">=</span> <span class="n">oscillationFactor</span> <span class="p">*</span> <span class="n">Math</span><span class="p">.</span><span class="n">ToRadians</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">ConeHalfAngle</span><span class="p">);</span>
</span>
  <span class="c1">// The firing angle is equal to the rotation angle about the Z axis</span>
  <span class="kt">var</span> <span class="n">firingAngle</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">Transform</span><span class="p">.</span><span class="n">EulerAngles</span><span class="p">.</span><span class="n">Z</span><span class="p">;</span>

  <span class="c1">// The length of a direction vector is 1, so we do not need to multiply</span>
  <span class="c1">// the cosine and sine of the angle by anything to get the x and y parts</span>
  <span class="kt">var</span> <span class="n">xPart</span> <span class="p">=</span> <span class="n">Math</span><span class="p">.</span><span class="n">Cos</span><span class="p">(</span><span class="n">firingAngle</span><span class="p">);</span>
  <span class="kt">var</span> <span class="n">yPart</span> <span class="p">=</span> <span class="n">Math</span><span class="p">.</span><span class="n">Sin</span><span class="p">(</span><span class="n">firingAngle</span><span class="p">);</span>
  <span class="c1">// This vector does not extend at all into the Z direction</span>
  <span class="kt">var</span> <span class="n">zPart</span> <span class="p">=</span> <span class="m">0.0</span><span class="p">;</span>

  <span class="kt">var</span> <span class="n">firingDirection</span> <span class="p">=</span> <span class="n">Real3</span><span class="p">(</span><span class="n">xPart</span><span class="p">,</span> <span class="n">yPart</span><span class="p">,</span> <span class="n">zPart</span><span class="p">);</span>

  <span class="n">water</span><span class="p">.</span><span class="n">RigidBody</span><span class="p">.</span><span class="n">Velocity</span> <span class="p">=</span> <span class="n">firingDirection</span> <span class="p">*</span> <span class="k">this</span><span class="p">.</span><span class="n">WaterSpeed</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">oscillationFactor</span></code> is multiplied by the <code class="docutils literal"><span class="pre">ConeHalfAngle</span></code> (in radians)
to produce the <code class="docutils literal"><span class="pre">waveAngle</span></code>. As the <code class="docutils literal"><span class="pre">oscillationFactor</span></code> oscillates between 1
and -1, the <code class="docutils literal"><span class="pre">waveAngle</span></code> oscillates between <code class="docutils literal"><span class="pre">ConeHalfAngle</span></code> and <em>negative</em>
<code class="docutils literal"><span class="pre">ConeHalfAngle</span></code>.</p>
<ul class="simple">
<li>In the WaterCannon script<ul>
<li>Make the following modification to the <code class="docutils literal"><span class="pre">Fire</span></code> function</li>
</ul>
</li>
</ul>
<div class="highlight-csharp"><div class="highlight"><pre><span></span><span class="n">function</span> <span class="nf">Fire</span><span class="p">()</span>
<span class="p">{</span>
  <span class="kt">var</span> <span class="n">waterPosition</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">Cannon</span><span class="p">.</span><span class="n">Cog</span><span class="p">.</span><span class="n">Transform</span><span class="p">.</span><span class="n">WorldTranslation</span><span class="p">;</span>
  <span class="n">waterPosition</span><span class="p">.</span><span class="n">Z</span> <span class="p">=</span> <span class="m">0.0</span><span class="p">;</span>
  <span class="kt">var</span> <span class="n">water</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">Space</span><span class="p">.</span><span class="n">CreateAtPosition</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">WaterArchetype</span><span class="p">,</span> <span class="n">waterPosition</span><span class="p">);</span>

  <span class="kt">var</span> <span class="n">facingAngle</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">Transform</span><span class="p">.</span><span class="n">EulerAngles</span><span class="p">.</span><span class="n">Z</span><span class="p">;</span>

  <span class="c1">// Here is our sine-based oscillation factor</span>
  <span class="kt">var</span> <span class="n">oscillationFactor</span> <span class="p">=</span> <span class="n">Math</span><span class="p">.</span><span class="n">Sin</span><span class="p">(</span><span class="n">Math</span><span class="p">.</span><span class="n">ToRadians</span><span class="p">(</span><span class="m">360.0</span> <span class="p">*</span> <span class="k">this</span><span class="p">.</span><span class="n">Time</span> <span class="p">/</span> <span class="k">this</span><span class="p">.</span><span class="n">WavePeriod</span><span class="p">));</span>

  <span class="c1">// The wave angle oscillates back and forth between the positive and negative ConeHalfAngle</span>
  <span class="c1">//   -- The wave angle is in radians</span>
  <span class="kt">var</span> <span class="n">waveAngle</span> <span class="p">=</span> <span class="n">oscillationFactor</span> <span class="p">*</span> <span class="n">Math</span><span class="p">.</span><span class="n">ToRadians</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">ConeHalfAngle</span><span class="p">);</span>

<span class="hll">  <span class="c1">// The firing angle is now the sum of the facing angle and the wave angle</span>
</span><span class="hll">  <span class="c1">//   -- Since the firing angle is a sum of two angles in radians, it, too, is in radians</span>
</span><span class="hll">  <span class="kt">var</span> <span class="n">firingAngle</span> <span class="p">=</span> <span class="n">facingAngle</span> <span class="p">+</span> <span class="n">waveAngle</span><span class="p">;</span>
</span>
  <span class="c1">// The length of a direction vector is 1, so we do not need to multiply</span>
  <span class="c1">// the cosine and sine of the angle by anything to get the x and y parts</span>
  <span class="kt">var</span> <span class="n">xPart</span> <span class="p">=</span> <span class="n">Math</span><span class="p">.</span><span class="n">Cos</span><span class="p">(</span><span class="n">firingAngle</span><span class="p">);</span>
  <span class="kt">var</span> <span class="n">yPart</span> <span class="p">=</span> <span class="n">Math</span><span class="p">.</span><span class="n">Sin</span><span class="p">(</span><span class="n">firingAngle</span><span class="p">);</span>
  <span class="c1">// This vector does not extend at all into the Z direction</span>
  <span class="kt">var</span> <span class="n">zPart</span> <span class="p">=</span> <span class="m">0.0</span><span class="p">;</span>

  <span class="kt">var</span> <span class="n">firingDirection</span> <span class="p">=</span> <span class="n">Real3</span><span class="p">(</span><span class="n">xPart</span><span class="p">,</span> <span class="n">yPart</span><span class="p">,</span> <span class="n">zPart</span><span class="p">);</span>

  <span class="n">water</span><span class="p">.</span><span class="n">RigidBody</span><span class="p">.</span><span class="n">Velocity</span> <span class="p">=</span> <span class="n">firingDirection</span> <span class="p">*</span> <span class="k">this</span><span class="p">.</span><span class="n">WaterSpeed</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>We&#8217;re finally able to revise our firing angle: it is now equal to the
<code class="docutils literal"><span class="pre">waveAngle</span></code> plus the <code class="docutils literal"><span class="pre">facingAngle</span></code>. The rest of the function remains the
same as it was before.</p>
<p>Let&#8217;s take it for a spin.</p>
<ul class="simple">
<li><a class="reference internal" href="SavingProject.html#savingproject"><span>Save the project</span></a> and <a class="reference internal" href="RunTheGame.html#runthegame"><span>run the game</span></a></li>
</ul>
<p><img alt="WavingWater" src="../../_images/WavingWater1.gif" /></p>
<p>Now the water waves back and forth while the mouse button is held down.</p>
<p>So why do we use a <code class="docutils literal"><span class="pre">ConeHalfAngle</span></code> property instead of <code class="docutils literal"><span class="pre">ConeAngle</span></code>? As the
output of the sine function driving the cannon&#8217;s oscillation goes back and forth
between 1 and -1, the <code class="docutils literal"><span class="pre">firingAngle</span></code> varies between <code class="docutils literal"><span class="pre">ConeHalfAngle</span></code> and
<em>negative</em> <code class="docutils literal"><span class="pre">ConeHalfAngle</span></code>. Thus, the range of possible values for the firing
angle given a constant facing angle is <code class="docutils literal"><span class="pre">ConeHalfAngle</span></code> <strong>minus</strong>
<span class="bolditalic">negative</span> <code class="docutils literal"><span class="pre">ConeHalfAngle</span></code>, or <code class="docutils literal"><span class="pre">ConeHalfAngle</span></code> <strong>plus</strong>
<code class="docutils literal"><span class="pre">ConeHalfAngle</span></code>, or <code class="docutils literal"><span class="pre">ConeHalfAngle</span></code> <strong>* 2</strong>.</p>
<p>Let&#8217;s say our <code class="docutils literal"><span class="pre">ConeHalfAngle</span></code> is set to <strong>15 degrees</strong>:</p>
<p><img alt="FiringCone" src="../../_images/FiringCone1.png" /></p>
<div class="sidebar">
<p class="first sidebar-title">Why Not Cosine?</p>
<p>Our WaterCannon&#8217;s <code class="docutils literal"><span class="pre">Fire</span></code> function uses the <strong>sine</strong> function to vary its
firing angle. What would happen if we were to use the <strong>cosine</strong> function
instead? Cosine has <strong>exactly the same output range</strong> as sine, except with a
<em>ninety-degree phase shift</em> &#8212; that is, the cosine of any angle is equal to
the sine of 90 degrees more than that angle.</p>
<p class="last">Thus, using <code class="docutils literal"><span class="pre">Math.Cos</span></code> instead of <code class="docutils literal"><span class="pre">Math.Sin</span></code> to produce the
<code class="docutils literal"><span class="pre">oscillationFactor</span></code> would have almost the same result, except that the
water stream would start at the side instead of starting in the middle like
it does with <code class="docutils literal"><span class="pre">Math.Sin</span></code>.</p>
</div>
<p>The firing cone consists of a &#8220;top half-cone,&#8221; produced while the output of the
sine function is <strong>positive</strong>, and a &#8220;bottom half-cone,&#8221; produced while the
output of the sine function is <strong>negative</strong>.</p>
<p>If we were to use a full cone angle property instead of a half-angle, then
wherever we want to refer to the width of the cone, we&#8217;d have to divide it in
half before we could use it.</p>
<div class="section" id="tuning-the-properties">
<h3>Tuning the Properties</h3>
<p>Let&#8217;s play around a bit with the properties on the WaterCannon component, to get
the behavior of the water stream just right.</p>
<ul class="simple">
<li><a class="reference internal" href="StopGame.html#stopgame"><span>Stop the Game</span></a></li>
<li><a class="reference internal" href="SelectObject.html#selectobject"><span>Select the Player object</span></a></li>
<li>In the Properties Window<ul>
<li>Under WaterCannon<ul>
<li>Set ConeHalfAngle to: <code class="docutils literal"><span class="pre">60</span></code></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="SavingProject.html#savingproject"><span>Save the project</span></a> and <a class="reference internal" href="RunTheGame.html#runthegame"><span>run the game</span></a></li>
</ul>
<p>This is, perhaps, too wide of a cone. Try finding a value that works well. This
lesson will proceed with a <code class="docutils literal"><span class="pre">ConeHalfAngle</span></code> of <strong>15</strong>.</p>
<ul class="simple">
<li><a class="reference internal" href="StopGame.html#stopgame"><span>Stop the Game</span></a></li>
<li><a class="reference internal" href="SelectObject.html#selectobject"><span>Select the Player object</span></a></li>
<li>In the Properties Window<ul>
<li>Under WaterCannon<ul>
<li>Set ConeHalfAngle to the desired value</li>
<li>Set WavePeriod to: <code class="docutils literal"><span class="pre">4.0</span></code></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="SavingProject.html#savingproject"><span>Save the project</span></a> and <a class="reference internal" href="RunTheGame.html#runthegame"><span>run the game</span></a></li>
</ul>
<p>This wave oscillates too slowly. Try finding a value that looks nice. This
lesson will proceed with a <code class="docutils literal"><span class="pre">WavePeriod</span></code> of <strong>0.27</strong>.</p>
<ul class="simple">
<li><a class="reference internal" href="StopGame.html#stopgame"><span>Stop the Game</span></a></li>
<li><a class="reference internal" href="SelectObject.html#selectobject"><span>Select the Player object</span></a></li>
<li>In the Properties Window<ul>
<li>Under WaterCannon<ul>
<li>Set WavePeriod to the desired value</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>There&#8217;s just one more feature to add before this lesson is complete.</p>
</div>
</div>
<div class="section" id="threat-range">
<h2>Threat Range</h2>
<p>We can imagine that the WaterCannon&#8217;s <code class="docutils literal"><span class="pre">ConeHalfAngle</span></code> property represents the
player&#8217;s <strong>threat range</strong> (or, rather, half thereof) &#8212; that is, anything the
player can &#8220;see,&#8221; based on their facing angle and the width of their firing
cone, is at risk of being soaked with water. We may wish to show the player
which targets they are threatening to soak before they even fire their cannon.</p>
<div class="section" id="finding-the-angle-between-two-vectors">
<h3>Finding the Angle Between Two Vectors</h3>
<div class="sidebar">
<p class="first sidebar-title">When to Use Degrees vs. Radians</p>
<p>The WaterCannon&#8217;s <code class="docutils literal"><span class="pre">ConeHalfAngle</span></code> property is a Real that specifies the
half-width of the angle of the firing arc for the water cannon. It is an
angle whose value is specified in <strong>degrees</strong>. Meanwhile, we&#8217;ve already
established that the Zero Engine&#8217;s functions (like <code class="docutils literal"><span class="pre">Math.Cos</span></code>) and
properties (like <code class="docutils literal"><span class="pre">Transform.EulerAngles</span></code>) expect angles in <strong>radians</strong>. So
why have we written the WaterCannon component so that <code class="docutils literal"><span class="pre">ConeHalfAngle</span></code> is
given in degrees instead of radians? Notably, we can observe that we&#8217;re just
going to have to convert its value into radians before we use it anyway.
What&#8217;s the point of requiring this additional step?</p>
<p class="last">It all comes down to the user&#8217;s experience. We have created
<code class="docutils literal"><span class="pre">ConeHalfAngle</span></code> as a property that is <em>exposed to the user</em> via the
editor&#8217;s Properties Window. We don&#8217;t want the user to have to type in
<code class="docutils literal"><span class="pre">0.523599</span></code> when they want to specify a half-angle of thirty degrees.
Publicly, the user sees a property where they type in a value in degrees,
and it all goes well; privately, behind the scenes, we convert to radians
for the math to work out properly. The same principle is at play with the
Transform component: we enter degrees for Euler angles into the <strong>Rotation</strong>
field in the Properties Window; behind the scenes, Zero converts the Euler
angles into a quaternion and uses that for all of its mathematical
calculations.</p>
</div>
<p>If we consider the vector from the player to the target to be the <strong>difference
vector</strong>, then what we want to do is find the <em>angle between the difference
vector and the player&#8217;s facing vector</em>. If this angle is small enough, then the
player is threatening the target:</p>
<p><img alt="ThreatAngleVectors" src="../../_images/ThreatAngleVectors1.gif" /></p>
<p>As it happens, there is a formula that will give us the <span class="bolditalic">cosine</span> <em>of the
angle between two vectors</em>, and it has a new vector math function we haven&#8217;t
covered yet: the <strong>dot product</strong>.</p>
<div class="math">
\[\cos(angleBetween_{vecA, vecB}) = \frac{\overrightarrow{vecA}\cdot\overrightarrow{vecB}}{||\overrightarrow{vecA}||*||\overrightarrow{vecB}||}\]</div>
<p>A couple of clarifications:</p>
<ul class="simple">
<li>The dot between <em>vecA</em> and <em>vecB</em> on the top of the fraction on the right is
the operator indicating the <em>dot product</em>.</li>
<li>The set of vertical lines on either side of <em>vecA</em> and <em>vecB</em> on the bottom
of the fraction is the operator indicating vector <strong>magnitude</strong>, or
<em>length</em>.<ul>
<li>Thus, the bottom of the fraction is the two vector lengths multiplied.</li>
</ul>
</li>
</ul>
<p>So, to recap this in English: the cosine of the angle between vectors <code class="docutils literal"><span class="pre">vecA</span></code>
and <code class="docutils literal"><span class="pre">vecB</span></code> is equal to their <strong>dot product divided by the product of their
lengths</strong>.</p>
<p>So what is the dot product? <em>The dot product of two vectors is the sum of the
products of the respective parts of the vectors</em> &#8212; that is, given vectors
<em>vecA</em> and <em>vecB</em>,</p>
<div class="math">
\[\overrightarrow{vecA}\cdot\overrightarrow{vecB} = (vecA_x * vecB_x) + (vecA_y * vecB_y) + (vecA_z * vecB_z)\]</div>
<p>Again, to find the dot product of two vectors, we <strong>multiply</strong> the X parts, the
Y parts, and the Z parts individually, and then <strong>add</strong> these results all
together:</p>
<div class="highlight-csharp"><div class="highlight"><pre><span></span><span class="kt">var</span> <span class="n">dotProductResult</span> <span class="p">:</span> <span class="n">Real</span> <span class="p">=</span> <span class="p">(</span><span class="n">vecA</span><span class="p">.</span><span class="n">X</span> <span class="p">*</span> <span class="n">vecB</span><span class="p">.</span><span class="n">X</span><span class="p">)</span> <span class="p">+</span> <span class="p">(</span><span class="n">vecA</span><span class="p">.</span><span class="n">Y</span> <span class="p">*</span> <span class="n">vecB</span><span class="p">.</span><span class="n">Y</span><span class="p">)</span> <span class="p">+</span> <span class="p">(</span><span class="n">vecA</span><span class="p">.</span><span class="n">Z</span> <span class="p">*</span> <span class="n">vecB</span><span class="p">.</span><span class="n">Z</span><span class="p">);</span>
</pre></div>
</div>
<p>(Of course, when working in the Zero Engine, we can just use the much more
convenient <code class="docutils literal"><span class="pre">Math.Dot</span></code> function instead:</p>
<div class="highlight-csharp"><div class="highlight"><pre><span></span><span class="kt">var</span> <span class="n">dotProductResult</span> <span class="p">:</span> <span class="n">Real</span> <span class="p">=</span> <span class="n">Math</span><span class="p">.</span><span class="n">Dot</span><span class="p">(</span><span class="n">vecA</span><span class="p">,</span> <span class="n">vecB</span><span class="p">);</span>
</pre></div>
</div>
<p>Some notes:</p>
<ul class="simple">
<li>The dot product of two vectors is <em>not</em> another vector &#8212; it is a
one-dimensional number, also known as a <strong>scalar</strong>, hence why the type
returned by <code class="docutils literal"><span class="pre">Math.Dot</span></code> is <code class="xref cpp cpp-type docutils literal"><span class="pre">Real</span></code>.</li>
<li>The Z parts of 2D vectors will generally always be 0, so the last term of
the dot product is often ignored when working in 2D.</li>
</ul>
<p>Once we find the dot product, we need to divide it by the lengths of each
vector. However, if we already know that both vectors have <em>lengths of exactly
1</em>, say, because they&#8217;re <strong>direction vectors</strong>, then we don&#8217;t need to divide: in
this case, the dot product equals the cosine.</p>
<p>Once we find the cosine of the angle we seek, we just need to take the <strong>inverse
cosine</strong> of it, and we have our angle. The <em>inverse cosine</em> of a number is equal
to the <em>smallest angle whose cosine is that number</em>. The inverse cosine function
is sometimes known as <em>arccosine</em>, <em>arccos</em>, <em>acos</em>, or <span class="math">\(\cos^{-1}\)</span>; in
Zero, we call it <code class="docutils literal"><span class="pre">Math.ACos</span></code>, and it outputs an angle in <strong>radians</strong>.</p>
</div>
<div class="section" id="putting-it-to-work">
<h3>Putting it to Work</h3>
<p>Let&#8217;s add a new component to the targets that check each frame to determine
whether they lie in the player&#8217;s threat range. If they do, they will change
their <a class="reference internal" href="../../ZeroManual/CodeReference/Reference/Sprite.html#_CPPv26Sprite" title="Sprite"><code class="xref cpp cpp-type docutils literal"><span class="pre">sprite</span></code></a>&#8216;s color to indicate that they are threatened.
If they are outside of the player&#8217;s threat range, they will change their color
to show that they are safe &#8212; <em>for now</em>. This component will use the dot
product to determine the angle between the difference vector from the player to
the target and the player&#8217;s facing vector.</p>
<ul class="simple">
<li><a class="reference internal" href="ResourceAdding.html#resourceadding"><span>Add a new ZilchScript resource</span></a> named: <code class="docutils literal"><span class="pre">ThreatIndicator</span></code></li>
<li>Update your new script to look like this:</li>
</ul>
<div class="highlight-csharp"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ThreatIndicator</span> <span class="p">:</span> <span class="n">ZilchComponent</span>
<span class="p">{</span>
  <span class="n">function</span> <span class="nf">Initialize</span><span class="p">(</span><span class="n">init</span> <span class="p">:</span> <span class="n">CogInitializer</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">Zero</span><span class="p">.</span><span class="n">Connect</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">Space</span><span class="p">,</span> <span class="n">Events</span><span class="p">.</span><span class="n">LogicUpdate</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="n">OnLogicUpdate</span><span class="p">);</span>
  <span class="p">}</span>


  <span class="n">function</span> <span class="nf">OnLogicUpdate</span><span class="p">(</span><span class="k">event</span> <span class="p">:</span> <span class="n">UpdateEvent</span><span class="p">)</span>
  <span class="p">{</span>

  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li>In the ThreatIndicator script<ul>
<li>Make the following set of additions to the code:</li>
</ul>
</li>
</ul>
<div class="highlight-csharp"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ThreatIndicator</span> <span class="p">:</span> <span class="n">ZilchComponent</span>
<span class="p">{</span>
<span class="na">  [Dependency]</span>
  <span class="kt">var</span> <span class="n">Transform</span> <span class="p">:</span> <span class="n">Transform</span><span class="p">;</span>
<span class="na">  [Dependency]</span>
  <span class="kt">var</span> <span class="n">Sprite</span> <span class="p">:</span> <span class="n">Sprite</span><span class="p">;</span>

  <span class="p">.</span>
  <span class="p">.</span>
  <span class="p">.</span>
</pre></div>
</div>
<p>This component has dependencies on both Transform and Sprite.</p>
<div class="nextblock container">
Next:</div>
<div class="highlight-csharp"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ThreatIndicator</span> <span class="p">:</span> <span class="n">ZilchComponent</span>
<span class="p">{</span>
<span class="na">  [Dependency]</span>
  <span class="kt">var</span> <span class="n">Transform</span> <span class="p">:</span> <span class="n">Transform</span><span class="p">;</span>
<span class="na">  [Dependency]</span>
  <span class="kt">var</span> <span class="n">Sprite</span> <span class="p">:</span> <span class="n">Sprite</span><span class="p">;</span>


<span class="hll"><span class="na">  [Property]</span>
</span><span class="hll">  <span class="kt">var</span> <span class="n">Player</span> <span class="p">:</span> <span class="n">CogPath</span><span class="p">;</span>
</span>
  <span class="p">.</span>
  <span class="p">.</span>
  <span class="p">.</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">Player</span></code> property is a <a class="reference internal" href="../../ZeroManual/CodeReference/Reference/CogPath.html#_CPPv27CogPath" title="CogPath"><code class="xref cpp cpp-type docutils literal"><span class="pre">CogPath</span></code></a> that we will soon point to the
player.</p>
<div class="nextblock container">
Next:</div>
<div class="highlight-csharp"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ThreatIndicator</span> <span class="p">:</span> <span class="n">ZilchComponent</span>
<span class="p">{</span>
<span class="na">  [Dependency]</span>
  <span class="kt">var</span> <span class="n">Transform</span> <span class="p">:</span> <span class="n">Transform</span><span class="p">;</span>
<span class="na">  [Dependency]</span>
  <span class="kt">var</span> <span class="n">Sprite</span> <span class="p">:</span> <span class="n">Sprite</span><span class="p">;</span>


<span class="na">  [Property]</span>
  <span class="kt">var</span> <span class="n">Player</span> <span class="p">:</span> <span class="n">CogPath</span><span class="p">;</span>

<span class="hll">  <span class="kt">var</span> <span class="n">SafeColor</span> <span class="p">:</span> <span class="n">Real4</span> <span class="p">=</span> <span class="n">Real4</span><span class="p">(</span><span class="m">1.0</span><span class="p">,</span> <span class="m">1.0</span><span class="p">,</span> <span class="m">0.0</span><span class="p">,</span> <span class="m">1.0</span><span class="p">);</span>
</span><span class="hll">  <span class="kt">var</span> <span class="n">ThreatColor</span> <span class="p">:</span> <span class="n">Real4</span> <span class="p">=</span> <span class="n">Real4</span><span class="p">(</span><span class="m">1.0</span><span class="p">,</span> <span class="m">0.0</span><span class="p">,</span> <span class="m">0.2</span><span class="p">,</span> <span class="m">1.0</span><span class="p">);</span>
</span>
  <span class="p">.</span>
  <span class="p">.</span>
  <span class="p">.</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">SafeColor</span></code> and <code class="docutils literal"><span class="pre">ThreatColor</span></code> member variables define what color the
target should turn when it is safe and when it is threatened, respectively.</p>
<div class="nextblock container">
Finally:</div>
<div class="highlight-csharp"><div class="highlight"><pre><span></span>  <span class="p">.</span>
  <span class="p">.</span>
  <span class="p">.</span>

  <span class="n">function</span> <span class="nf">OnLogicUpdate</span><span class="p">(</span><span class="k">event</span> <span class="p">:</span> <span class="n">UpdateEvent</span><span class="p">)</span>
  <span class="p">{</span>
<span class="hll">    <span class="k">this</span><span class="p">.</span><span class="n">CheckThreat</span><span class="p">();</span>
</span>  <span class="p">}</span>


<span class="hll">  <span class="n">function</span> <span class="nf">CheckThreat</span><span class="p">()</span>
</span><span class="hll">  <span class="p">{</span>
</span><span class="hll">
</span><span class="hll">  <span class="p">}</span>
</span><span class="p">}</span>
</pre></div>
</div>
<p>Every frame, the target will check whether it is threatened using the
<code class="docutils literal"><span class="pre">CheckThreat</span></code> function.</p>
<p>Let&#8217;s put this on a target and then start filling in its code.</p>
<ul class="simple">
<li><a class="reference internal" href="SelectObject.html#selectobject"><span>Select a Target object</span></a></li>
<li>In the Properties Window<ul>
<li><a class="reference internal" href="AddComponent.html#addcomponent"><span>Add a ThreatIndicator component</span></a></li>
<li>Under ThreatIndicator<ul>
<li><a class="reference internal" href="CogPaths.html#cogpaths"><span>Point the Player CogPath property to the Player Object</span></a></li>
</ul>
</li>
<li><code class="docutils literal"><span class="pre">Left-click</span></code> the green <strong>Upload to Archetype</strong> button</li>
</ul>
</li>
</ul>
<p>Now all of the targets in the level should have a CogPath reference to the
player.</p>
<p>Now to find that angle. Once again, what we&#8217;re looking for is the player&#8217;s angle
from the target, so that we can compare it to the WaterCannon&#8217;s
<code class="docutils literal"><span class="pre">ConeHalfAngle</span></code>. To find this angle, we need to find two direction vectors:</p>
<ol class="arabic simple">
<li>the direction pointing from the player to the target, and</li>
<li>the player&#8217;s facing vector</li>
</ol>
<p>Let&#8217;s get started.</p>
<ul class="simple">
<li>In the ThreatIndicator script<ul>
<li>Make the following set of additions to the <code class="docutils literal"><span class="pre">CheckThreat</span></code> function:</li>
</ul>
</li>
</ul>
<div class="highlight-csharp"><div class="highlight"><pre><span></span><span class="n">function</span> <span class="nf">CheckThreat</span><span class="p">()</span>
<span class="p">{</span>
<span class="hll">  <span class="kt">var</span> <span class="n">playerPosition</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">Player</span><span class="p">.</span><span class="n">Cog</span><span class="p">.</span><span class="n">Transform</span><span class="p">.</span><span class="n">Translation</span><span class="p">;</span>
</span><span class="hll">  <span class="kt">var</span> <span class="n">targetPosition</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">Transform</span><span class="p">.</span><span class="n">Translation</span><span class="p">;</span>
</span><span class="p">}</span>
</pre></div>
</div>
<p>To find the direction from the player to the target, we first need their
difference vector, and that means we need both of their positions.</p>
<div class="nextblock container">
Next:</div>
<div class="highlight-csharp"><div class="highlight"><pre><span></span><span class="n">function</span> <span class="nf">CheckThreat</span><span class="p">()</span>
<span class="p">{</span>
  <span class="kt">var</span> <span class="n">playerPosition</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">Player</span><span class="p">.</span><span class="n">Cog</span><span class="p">.</span><span class="n">Transform</span><span class="p">.</span><span class="n">Translation</span><span class="p">;</span>
  <span class="kt">var</span> <span class="n">targetPosition</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">Transform</span><span class="p">.</span><span class="n">Translation</span><span class="p">;</span>

<span class="hll">  <span class="kt">var</span> <span class="n">playerToTarget</span> <span class="p">=</span> <span class="n">targetPosition</span> <span class="p">-</span> <span class="n">playerPosition</span><span class="p">;</span>
</span><span class="hll">  <span class="kt">var</span> <span class="n">playerDirectionToTarget</span> <span class="p">=</span> <span class="n">Math</span><span class="p">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">playerToTarget</span><span class="p">);</span>
</span><span class="p">}</span>
</pre></div>
</div>
<p>Remember, the difference vector between two points is the <em>target point minus
the source point</em>. Once we have the <code class="docutils literal"><span class="pre">playerToTarget</span></code> difference vector, we
<em>normalize</em> it, giving us the <em>direction from the player to the target</em>.</p>
<p>Now we need the player&#8217;s <strong>facing direction</strong>, but we already know how to find
that.</p>
<div class="nextblock container">
Next:</div>
<div class="highlight-csharp"><div class="highlight"><pre><span></span><span class="n">function</span> <span class="nf">CheckThreat</span><span class="p">()</span>
<span class="p">{</span>
  <span class="kt">var</span> <span class="n">playerPosition</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">Player</span><span class="p">.</span><span class="n">Cog</span><span class="p">.</span><span class="n">Transform</span><span class="p">.</span><span class="n">Translation</span><span class="p">;</span>
  <span class="kt">var</span> <span class="n">targetPosition</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">Transform</span><span class="p">.</span><span class="n">Translation</span><span class="p">;</span>

  <span class="kt">var</span> <span class="n">playerToTarget</span> <span class="p">=</span> <span class="n">targetPosition</span> <span class="p">-</span> <span class="n">playerPosition</span><span class="p">;</span>
  <span class="kt">var</span> <span class="n">playerDirectionToTarget</span> <span class="p">=</span> <span class="n">Math</span><span class="p">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">playerToTarget</span><span class="p">);</span>

<span class="hll">  <span class="kt">var</span> <span class="n">playerAngle</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">Player</span><span class="p">.</span><span class="n">Cog</span><span class="p">.</span><span class="n">Transform</span><span class="p">.</span><span class="n">EulerAngles</span><span class="p">.</span><span class="n">Z</span><span class="p">;</span>
</span><span class="hll">
</span><span class="hll">  <span class="kt">var</span> <span class="n">playerFacingX</span> <span class="p">=</span> <span class="n">Math</span><span class="p">.</span><span class="n">Cos</span><span class="p">(</span><span class="n">playerAngle</span><span class="p">);</span>
</span><span class="hll">  <span class="kt">var</span> <span class="n">playerFacingY</span> <span class="p">=</span> <span class="n">Math</span><span class="p">.</span><span class="n">Sin</span><span class="p">(</span><span class="n">playerAngle</span><span class="p">);</span>
</span><span class="hll">  <span class="kt">var</span> <span class="n">playerFacingZ</span> <span class="p">=</span> <span class="m">0.0</span><span class="p">;</span>
</span><span class="hll">
</span><span class="hll">  <span class="kt">var</span> <span class="n">playerFacing</span> <span class="p">=</span> <span class="n">Real3</span><span class="p">(</span><span class="n">playerFacingX</span><span class="p">,</span> <span class="n">playerFacingY</span><span class="p">,</span> <span class="n">playerFacingZ</span><span class="p">);</span>
</span><span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li>The X part of the facing vector is the <strong>cosine of the facing angle</strong>.</li>
<li>The Y part of the facing vector is the <strong>sine of the facing angle</strong>.</li>
<li>The Z part of the facing vector is <strong>0</strong>, because we&#8217;re working in 2D.</li>
</ul>
<p>Now we have both direction vectors.</p>
<div class="nextblock container">
Next:</div>
<div class="highlight-csharp"><div class="highlight"><pre><span></span><span class="n">function</span> <span class="nf">CheckThreat</span><span class="p">()</span>
<span class="p">{</span>
  <span class="kt">var</span> <span class="n">playerPosition</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">Player</span><span class="p">.</span><span class="n">Cog</span><span class="p">.</span><span class="n">Transform</span><span class="p">.</span><span class="n">Translation</span><span class="p">;</span>
  <span class="kt">var</span> <span class="n">targetPosition</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">Transform</span><span class="p">.</span><span class="n">Translation</span><span class="p">;</span>

  <span class="kt">var</span> <span class="n">playerToTarget</span> <span class="p">=</span> <span class="n">targetPosition</span> <span class="p">-</span> <span class="n">playerPosition</span><span class="p">;</span>
  <span class="kt">var</span> <span class="n">playerDirectionToTarget</span> <span class="p">=</span> <span class="n">Math</span><span class="p">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">playerToTarget</span><span class="p">);</span>

  <span class="kt">var</span> <span class="n">playerAngle</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">Player</span><span class="p">.</span><span class="n">Cog</span><span class="p">.</span><span class="n">Transform</span><span class="p">.</span><span class="n">EulerAngles</span><span class="p">.</span><span class="n">Z</span><span class="p">;</span>

  <span class="kt">var</span> <span class="n">playerFacingX</span> <span class="p">=</span> <span class="n">Math</span><span class="p">.</span><span class="n">Cos</span><span class="p">(</span><span class="n">playerAngle</span><span class="p">);</span>
  <span class="kt">var</span> <span class="n">playerFacingY</span> <span class="p">=</span> <span class="n">Math</span><span class="p">.</span><span class="n">Sin</span><span class="p">(</span><span class="n">playerAngle</span><span class="p">);</span>
  <span class="kt">var</span> <span class="n">playerFacingZ</span> <span class="p">=</span> <span class="m">0.0</span><span class="p">;</span>

  <span class="kt">var</span> <span class="n">playerFacing</span> <span class="p">=</span> <span class="n">Real3</span><span class="p">(</span><span class="n">playerFacingX</span><span class="p">,</span> <span class="n">playerFacingY</span><span class="p">,</span> <span class="n">playerFacingZ</span><span class="p">);</span>

<span class="hll">  <span class="kt">var</span> <span class="n">cosineOfAngle</span> <span class="p">=</span> <span class="n">Math</span><span class="p">.</span><span class="n">Dot</span><span class="p">(</span><span class="n">playerDirectionToTarget</span><span class="p">,</span> <span class="n">playerFacing</span><span class="p">);</span>
</span><span class="hll">  <span class="kt">var</span> <span class="n">playerAngleToTarget</span> <span class="p">=</span> <span class="n">Math</span><span class="p">.</span><span class="n">ACos</span><span class="p">(</span><span class="n">cosineOfAngle</span><span class="p">);</span>
</span><span class="p">}</span>
</pre></div>
</div>
<p>Now we <strong>dot</strong> the two vectors, giving us the <em>cosine of the angle</em> we&#8217;re
looking for. We then just employ the <code class="docutils literal"><span class="pre">Math.ACos</span></code> function, and we have our
angle.</p>
<ul class="simple">
<li>The angle we get back from the <code class="docutils literal"><span class="pre">Math.ACos</span></code> function is in <strong>radians</strong>.
The WaterCannon&#8217;s <code class="docutils literal"><span class="pre">ConeHalfAngle</span></code> property is in <strong>degrees</strong>. This means
that before we can compare them, we&#8217;ll have to convert one to the other.</li>
</ul>
<div class="nextblock container">
Next:</div>
<div class="highlight-csharp"><div class="highlight"><pre><span></span><span class="n">function</span> <span class="nf">CheckThreat</span><span class="p">()</span>
<span class="p">{</span>
  <span class="kt">var</span> <span class="n">playerPosition</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">Player</span><span class="p">.</span><span class="n">Cog</span><span class="p">.</span><span class="n">Transform</span><span class="p">.</span><span class="n">Translation</span><span class="p">;</span>
  <span class="kt">var</span> <span class="n">targetPosition</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">Transform</span><span class="p">.</span><span class="n">Translation</span><span class="p">;</span>

  <span class="kt">var</span> <span class="n">playerToTarget</span> <span class="p">=</span> <span class="n">targetPosition</span> <span class="p">-</span> <span class="n">playerPosition</span><span class="p">;</span>
  <span class="kt">var</span> <span class="n">playerDirectionToTarget</span> <span class="p">=</span> <span class="n">Math</span><span class="p">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">playerToTarget</span><span class="p">);</span>

  <span class="kt">var</span> <span class="n">playerAngle</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">Player</span><span class="p">.</span><span class="n">Cog</span><span class="p">.</span><span class="n">Transform</span><span class="p">.</span><span class="n">EulerAngles</span><span class="p">.</span><span class="n">Z</span><span class="p">;</span>

  <span class="kt">var</span> <span class="n">playerFacingX</span> <span class="p">=</span> <span class="n">Math</span><span class="p">.</span><span class="n">Cos</span><span class="p">(</span><span class="n">playerAngle</span><span class="p">);</span>
  <span class="kt">var</span> <span class="n">playerFacingY</span> <span class="p">=</span> <span class="n">Math</span><span class="p">.</span><span class="n">Sin</span><span class="p">(</span><span class="n">playerAngle</span><span class="p">);</span>
  <span class="kt">var</span> <span class="n">playerFacingZ</span> <span class="p">=</span> <span class="m">0.0</span><span class="p">;</span>

  <span class="kt">var</span> <span class="n">playerFacing</span> <span class="p">=</span> <span class="n">Real3</span><span class="p">(</span><span class="n">playerFacingX</span><span class="p">,</span> <span class="n">playerFacingY</span><span class="p">,</span> <span class="n">playerFacingZ</span><span class="p">);</span>

  <span class="kt">var</span> <span class="n">cosineOfAngle</span> <span class="p">=</span> <span class="n">Math</span><span class="p">.</span><span class="n">Dot</span><span class="p">(</span><span class="n">playerDirectionToTarget</span><span class="p">,</span> <span class="n">playerFacing</span><span class="p">);</span>
  <span class="kt">var</span> <span class="n">playerAngleToTarget</span> <span class="p">=</span> <span class="n">Math</span><span class="p">.</span><span class="n">ACos</span><span class="p">(</span><span class="n">cosineOfAngle</span><span class="p">);</span>

<span class="hll">  <span class="kt">var</span> <span class="n">playerConeHalfAngleRadians</span> <span class="p">=</span> <span class="n">Math</span><span class="p">.</span><span class="n">Radians</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">Player</span><span class="p">.</span><span class="n">Cog</span><span class="p">.</span><span class="n">WaterCannon</span><span class="p">.</span><span class="n">ConeHalfAngle</span><span class="p">);</span>
</span><span class="p">}</span>
</pre></div>
</div>
<p>Now we&#8217;ve converted the WaterCannon&#8217;s <code class="docutils literal"><span class="pre">ConeHalfAngle</span></code> property into radians,
and we&#8217;re ready to compare.</p>
<div class="nextblock container">
Finally:</div>
<div class="highlight-csharp"><div class="highlight"><pre><span></span><span class="n">function</span> <span class="nf">CheckThreat</span><span class="p">()</span>
<span class="p">{</span>
  <span class="kt">var</span> <span class="n">playerPosition</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">Player</span><span class="p">.</span><span class="n">Cog</span><span class="p">.</span><span class="n">Transform</span><span class="p">.</span><span class="n">Translation</span><span class="p">;</span>
  <span class="kt">var</span> <span class="n">targetPosition</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">Transform</span><span class="p">.</span><span class="n">Translation</span><span class="p">;</span>

  <span class="kt">var</span> <span class="n">playerToTarget</span> <span class="p">=</span> <span class="n">targetPosition</span> <span class="p">-</span> <span class="n">playerPosition</span><span class="p">;</span>
  <span class="kt">var</span> <span class="n">playerDirectionToTarget</span> <span class="p">=</span> <span class="n">Math</span><span class="p">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">playerToTarget</span><span class="p">);</span>

  <span class="kt">var</span> <span class="n">playerAngle</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">Player</span><span class="p">.</span><span class="n">Cog</span><span class="p">.</span><span class="n">Transform</span><span class="p">.</span><span class="n">EulerAngles</span><span class="p">.</span><span class="n">Z</span><span class="p">;</span>

  <span class="kt">var</span> <span class="n">playerFacingX</span> <span class="p">=</span> <span class="n">Math</span><span class="p">.</span><span class="n">Cos</span><span class="p">(</span><span class="n">playerAngle</span><span class="p">);</span>
  <span class="kt">var</span> <span class="n">playerFacingY</span> <span class="p">=</span> <span class="n">Math</span><span class="p">.</span><span class="n">Sin</span><span class="p">(</span><span class="n">playerAngle</span><span class="p">);</span>
  <span class="kt">var</span> <span class="n">playerFacingZ</span> <span class="p">=</span> <span class="m">0.0</span><span class="p">;</span>

  <span class="kt">var</span> <span class="n">playerFacing</span> <span class="p">=</span> <span class="n">Real3</span><span class="p">(</span><span class="n">playerFacingX</span><span class="p">,</span> <span class="n">playerFacingY</span><span class="p">,</span> <span class="n">playerFacingZ</span><span class="p">);</span>

  <span class="kt">var</span> <span class="n">cosineOfAngle</span> <span class="p">=</span> <span class="n">Math</span><span class="p">.</span><span class="n">Dot</span><span class="p">(</span><span class="n">playerDirectionToTarget</span><span class="p">,</span> <span class="n">playerFacing</span><span class="p">);</span>
  <span class="kt">var</span> <span class="n">playerAngleToTarget</span> <span class="p">=</span> <span class="n">Math</span><span class="p">.</span><span class="n">ACos</span><span class="p">(</span><span class="n">cosineOfAngle</span><span class="p">);</span>

  <span class="kt">var</span> <span class="n">playerConeHalfAngleRadians</span> <span class="p">=</span> <span class="n">Math</span><span class="p">.</span><span class="n">Radians</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">Player</span><span class="p">.</span><span class="n">Cog</span><span class="p">.</span><span class="n">WaterCannon</span><span class="p">.</span><span class="n">ConeHalfAngle</span><span class="p">);</span>

<span class="hll">  <span class="k">if</span><span class="p">(</span><span class="n">playerAngleToTarget</span> <span class="p">&lt;=</span> <span class="n">playerConeHalfAngleRadians</span><span class="p">)</span>
</span><span class="hll">  <span class="p">{</span>
</span><span class="hll">    <span class="k">this</span><span class="p">.</span><span class="n">Sprite</span><span class="p">.</span><span class="n">Color</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">ThreatColor</span><span class="p">;</span>
</span><span class="hll">  <span class="p">}</span>
</span><span class="hll">  <span class="k">else</span>
</span><span class="hll">  <span class="p">{</span>
</span><span class="hll">    <span class="k">this</span><span class="p">.</span><span class="n">Sprite</span><span class="p">.</span><span class="n">Color</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">SafeColor</span><span class="p">;</span>
</span><span class="hll">  <span class="p">}</span>
</span><span class="p">}</span>
</pre></div>
</div>
<p>Finally, we compare the angle we found earlier to the WaterCannon&#8217;s
<code class="docutils literal"><span class="pre">ConeHalfAngle</span></code>, converted to radians. If the angle is within the cone, then
the target is <strong>threatened</strong>, and we change its color accordingly. If it&#8217;s not,
then the target is <strong>safe</strong>, and we apply its <code class="docutils literal"><span class="pre">SafeColor</span></code>.</p>
<p>Let&#8217;s try it out.</p>
<ul class="simple">
<li><a class="reference internal" href="SavingProject.html#savingproject"><span>Save the project</span></a> and <a class="reference internal" href="RunTheGame.html#runthegame"><span>run the game</span></a></li>
</ul>
<p><img alt="ThreatIndicationAndSoaking" src="../../_images/ThreatIndicationAndSoaking1.gif" /></p>
<p>Now the targets change colors to indicate whether they are within the player&#8217;s
threat range. Changing the value of the <code class="docutils literal"><span class="pre">ConeHalfAngle</span></code> property on the
player&#8217;s WaterCannon will change this threat range.</p>
<div class="admonition-unthreatened-targets-being-soaked-regardless admonition">
<p class="first admonition-title">Unthreatened Targets Being Soaked Regardless</p>
<p>If you look closely, you may notice that it is possible, under certain
conditions, to soak a target in water even when it is <em>not threatened</em>.</p>
<p class="last">Why is this possible? This is left as an exercise for the reader.</p>
</div>
<p>Now we know more about how to use vector math to move and rotate objects and add
functionality to our games.</p>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="2DRotation.html" class="btn btn-neutral float-right" title="2D Rotation" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="ObjectCreation.html" class="btn btn-neutral" title="Object Creation" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, DigiPen Institute of Technology.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org/">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'1.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="../../../cdn.mathjax.org/mathjax/latest/MathJaxdda6.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
  
<script src="../../_static/js/extjquery.js"></script>



</body>

<!-- Mirrored from zero.digipen.edu/Workshops/2016/VectorMath2.html by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 27 Dec 2022 23:50:54 GMT -->
</html>